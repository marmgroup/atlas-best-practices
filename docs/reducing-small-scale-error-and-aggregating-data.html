<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 4 Reducing Small-Scale Error and Aggregating Data | A Rough Guide to Pre-processing High-Frequency Animal Tracking Data</title>
  <meta name="description" content="Source code for a guide to pre-processing high-frequency tracking data." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 4 Reducing Small-Scale Error and Aggregating Data | A Rough Guide to Pre-processing High-Frequency Animal Tracking Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Source code for a guide to pre-processing high-frequency tracking data." />
  <meta name="github-repo" content="pratikunterwegs/atlas-best-practices" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 4 Reducing Small-Scale Error and Aggregating Data | A Rough Guide to Pre-processing High-Frequency Animal Tracking Data" />
  
  <meta name="twitter:description" content="Source code for a guide to pre-processing high-frequency tracking data." />
  

<meta name="author" content="Pratik R. Gupte and others" />


<meta name="date" content="2020-11-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reducing-large-scale-positioning-error-by-filtering-data.html"/>
<link rel="next" href="residence-patches-and-their-construction.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Abstract</a></li>
<li class="chapter" data-level="2" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>2</b> Getting started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started.html"><a href="getting-started.html#installing-atlastools"><i class="fa fa-check"></i><b>2.1</b> Installing <code>atlastools</code></a></li>
<li class="chapter" data-level="2.2" data-path="getting-started.html"><a href="getting-started.html#simulating-movement-data"><i class="fa fa-check"></i><b>2.2</b> Simulating movement data</a></li>
<li class="chapter" data-level="2.3" data-path="getting-started.html"><a href="getting-started.html#simualte-for-residence-patches"><i class="fa fa-check"></i><b>2.3</b> Simualte for residence patches</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="getting-started.html"><a href="getting-started.html#simulate-thermalling"><i class="fa fa-check"></i><b>2.3.1</b> Simulate thermalling</a></li>
<li class="chapter" data-level="2.3.2" data-path="getting-started.html"><a href="getting-started.html#simulate-movement-between-patches"><i class="fa fa-check"></i><b>2.3.2</b> Simulate movement between patches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html"><i class="fa fa-check"></i><b>3</b> Reducing Large-Scale Positioning Error by Filtering Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#prepare-libraries"><i class="fa fa-check"></i><b>3.1</b> Prepare Libraries</a></li>
<li class="chapter" data-level="3.2" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#introducing-errors-to-the-data"><i class="fa fa-check"></i><b>3.2</b> Introducing Errors to the Data</a></li>
<li class="chapter" data-level="3.3" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#filtering-by-spatial-bounds"><i class="fa fa-check"></i><b>3.3</b> Filtering by Spatial Bounds</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#a-note-on-filtering-by-bounds"><i class="fa fa-check"></i><b>3.3.1</b> A Note on Filtering by Bounds</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#filtering-unrealistic-movement"><i class="fa fa-check"></i><b>3.4</b> Filtering Unrealistic Movement</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#filtering-point-outliers-or-spikes"><i class="fa fa-check"></i><b>3.4.1</b> Filtering Point Outliers or Spikes</a></li>
<li class="chapter" data-level="3.4.2" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#filtering-reflections-or-track-subsets"><i class="fa fa-check"></i><b>3.4.2</b> Filtering Reflections or Track Subsets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reducing-small-scale-error-and-aggregating-data.html"><a href="reducing-small-scale-error-and-aggregating-data.html"><i class="fa fa-check"></i><b>4</b> Reducing Small-Scale Error and Aggregating Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="reducing-small-scale-error-and-aggregating-data.html"><a href="reducing-small-scale-error-and-aggregating-data.html#preparing-libraries-and-data"><i class="fa fa-check"></i><b>4.1</b> Preparing Libraries and Data</a></li>
<li class="chapter" data-level="4.2" data-path="reducing-small-scale-error-and-aggregating-data.html"><a href="reducing-small-scale-error-and-aggregating-data.html#median-smoothing"><i class="fa fa-check"></i><b>4.2</b> Median Smoothing</a></li>
<li class="chapter" data-level="4.3" data-path="reducing-small-scale-error-and-aggregating-data.html"><a href="reducing-small-scale-error-and-aggregating-data.html#thinning-data-by-aggregation"><i class="fa fa-check"></i><b>4.3</b> Thinning Data by Aggregation</a></li>
<li class="chapter" data-level="4.4" data-path="reducing-small-scale-error-and-aggregating-data.html"><a href="reducing-small-scale-error-and-aggregating-data.html#aggregation-before-reducing-positioning-errors"><i class="fa fa-check"></i><b>4.4</b> Aggregation Before Reducing Positioning Errors</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="reducing-small-scale-error-and-aggregating-data.html"><a href="reducing-small-scale-error-and-aggregating-data.html#comparing-median-aggregation-with-and-without-smoothing"><i class="fa fa-check"></i><b>4.4.1</b> Comparing median aggregation with and without smoothing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html"><i class="fa fa-check"></i><b>5</b> Residence patches and their construction</a>
<ul>
<li class="chapter" data-level="" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#prepare-libraries"><i class="fa fa-check"></i>Prepare libraries</a></li>
<li class="chapter" data-level="5.1" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html#an-example-with-simulated-data"><i class="fa fa-check"></i><b>5.1</b> An example with simulated data</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html#read-data-and-classify"><i class="fa fa-check"></i><b>5.1.1</b> Read data and classify</a></li>
<li class="chapter" data-level="5.1.2" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html#plot-classified-residence-patches"><i class="fa fa-check"></i><b>5.1.2</b> Plot classified residence patches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html"><i class="fa fa-check"></i><b>6</b> Processing calibration data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#prepare-libraries"><i class="fa fa-check"></i><b>6.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="6.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#preliminary-visualisation"><i class="fa fa-check"></i><b>6.2</b> Preliminary visualisation</a></li>
<li class="chapter" data-level="6.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#filter-by-bounding-box"><i class="fa fa-check"></i><b>6.3</b> Filter by bounding box</a></li>
<li class="chapter" data-level="6.4" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#filter-trajectories"><i class="fa fa-check"></i><b>6.4</b> Filter trajectories</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#handle-time"><i class="fa fa-check"></i><b>6.4.1</b> Handle time</a></li>
<li class="chapter" data-level="6.4.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#add-speed-and-turning-angle"><i class="fa fa-check"></i><b>6.4.2</b> Add speed and turning angle</a></li>
<li class="chapter" data-level="6.4.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#get-95th-percentile-of-speed-and-angle"><i class="fa fa-check"></i><b>6.4.3</b> Get 95th percentile of speed and angle</a></li>
<li class="chapter" data-level="6.4.4" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-to-see-speeds"><i class="fa fa-check"></i><b>6.4.4</b> Plot to see speeds</a></li>
<li class="chapter" data-level="6.4.5" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#filter-on-speed"><i class="fa fa-check"></i><b>6.4.5</b> Filter on speed</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#smoothing-the-trajectory"><i class="fa fa-check"></i><b>6.5</b> Smoothing the trajectory</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-smoothed-data"><i class="fa fa-check"></i><b>6.5.1</b> Plot smoothed data</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#thinning-the-data"><i class="fa fa-check"></i><b>6.6</b> Thinning the data</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-thinned-data"><i class="fa fa-check"></i><b>6.6.1</b> Plot thinned data</a></li>
<li class="chapter" data-level="6.6.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-pre-processing-steps"><i class="fa fa-check"></i><b>6.6.2</b> Plot pre-processing steps</a></li>
<li class="chapter" data-level="6.6.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#calculate-residence-time"><i class="fa fa-check"></i><b>6.6.3</b> Calculate residence time</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#residence-patches"><i class="fa fa-check"></i><b>6.7</b> Residence patches</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#prepare-data"><i class="fa fa-check"></i><b>6.7.1</b> Prepare data</a></li>
<li class="chapter" data-level="6.7.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#run-residence-patch-method"><i class="fa fa-check"></i><b>6.7.2</b> Run residence patch method</a></li>
<li class="chapter" data-level="6.7.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#get-spatial-and-summary-objects"><i class="fa fa-check"></i><b>6.7.3</b> Get spatial and summary objects</a></li>
<li class="chapter" data-level="6.7.4" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#get-waypoint-centroids"><i class="fa fa-check"></i><b>6.7.4</b> Get waypoint centroids</a></li>
<li class="chapter" data-level="6.7.5" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#read-griend"><i class="fa fa-check"></i><b>6.7.5</b> Read Griend</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#compare-patch-metrics"><i class="fa fa-check"></i><b>6.8</b> Compare patch metrics</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#compare-known-patches"><i class="fa fa-check"></i><b>6.8.1</b> Compare known patches</a></li>
<li class="chapter" data-level="6.8.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-durations-comparisons"><i class="fa fa-check"></i><b>6.8.2</b> Plot durations comparisons</a></li>
<li class="chapter" data-level="6.8.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#join-patch-map-and-duration-comparison-figure"><i class="fa fa-check"></i><b>6.8.3</b> Join patch map and duration comparison figure</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html"><i class="fa fa-check"></i><b>7</b> Processing Egyptian fruit bat tracks</a>
<ul>
<li class="chapter" data-level="7.1" data-path="reducing-large-scale-positioning-error-by-filtering-data.html"><a href="reducing-large-scale-positioning-error-by-filtering-data.html#prepare-libraries"><i class="fa fa-check"></i><b>7.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="7.2" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#read-bat-data"><i class="fa fa-check"></i><b>7.2</b> Read bat data</a></li>
<li class="chapter" data-level="7.3" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sanity-check-plot-bat-data"><i class="fa fa-check"></i><b>7.3</b> Sanity check: Plot bat data</a></li>
<li class="chapter" data-level="7.4" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#prepare-data-for-filtering"><i class="fa fa-check"></i><b>7.4</b> Prepare data for filtering</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#prepare-data-per-individual"><i class="fa fa-check"></i><b>7.4.1</b> Prepare data per individual</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#filter-by-covariates"><i class="fa fa-check"></i><b>7.5</b> Filter by covariates</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sanity-check-plot-filtered-data"><i class="fa fa-check"></i><b>7.5.1</b> Sanity check: Plot filtered data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#filter-by-speed"><i class="fa fa-check"></i><b>7.6</b> Filter by speed</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sanity-check-plot-speed-filtered-data"><i class="fa fa-check"></i><b>7.6.1</b> Sanity check: Plot speed filtered data</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="reducing-small-scale-error-and-aggregating-data.html"><a href="reducing-small-scale-error-and-aggregating-data.html#median-smoothing"><i class="fa fa-check"></i><b>7.7</b> Median smoothing</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sanity-check-plot-smoothed-data"><i class="fa fa-check"></i><b>7.7.1</b> Sanity check: Plot smoothed data</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#making-residence-patches"><i class="fa fa-check"></i><b>7.8</b> Making residence patches</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#calculating-residence-time"><i class="fa fa-check"></i><b>7.8.1</b> Calculating residence time</a></li>
<li class="chapter" data-level="7.8.2" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sanity-check-residence-time-time-series"><i class="fa fa-check"></i><b>7.8.2</b> Sanity check: Residence-time time-series</a></li>
<li class="chapter" data-level="7.8.3" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#constructing-residence-patches"><i class="fa fa-check"></i><b>7.8.3</b> Constructing residence patches</a></li>
<li class="chapter" data-level="7.8.4" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#getting-residence-patch-data"><i class="fa fa-check"></i><b>7.8.4</b> Getting residence patch data</a></li>
<li class="chapter" data-level="7.8.5" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#write-patch-spatial-representations"><i class="fa fa-check"></i><b>7.8.5</b> Write patch spatial representations</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#processed-bat-patches"><i class="fa fa-check"></i><b>7.9</b> Processed bat patches</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Rough Guide to Pre-processing High-Frequency Animal Tracking Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reducing-small-scale-error-and-aggregating-data" class="section level1">
<h1><span class="header-section-number">Section 4</span> Reducing Small-Scale Error and Aggregating Data</h1>
<div id="preparing-libraries-and-data" class="section level2">
<h2><span class="header-section-number">4.1</span> Preparing Libraries and Data</h2>
<p>We first load some useful packages and define a colour palette.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="reducing-small-scale-error-and-aggregating-data.html#cb20-1"></a><span class="co"># prep libs</span></span>
<span id="cb20-2"><a href="reducing-small-scale-error-and-aggregating-data.html#cb20-2"></a><span class="kw">library</span>(data.table)</span>
<span id="cb20-3"><a href="reducing-small-scale-error-and-aggregating-data.html#cb20-3"></a><span class="kw">library</span>(atlastools)</span>
<span id="cb20-4"><a href="reducing-small-scale-error-and-aggregating-data.html#cb20-4"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb20-5"><a href="reducing-small-scale-error-and-aggregating-data.html#cb20-5"></a><span class="kw">library</span>(patchwork)</span>
<span id="cb20-6"><a href="reducing-small-scale-error-and-aggregating-data.html#cb20-6"></a></span>
<span id="cb20-7"><a href="reducing-small-scale-error-and-aggregating-data.html#cb20-7"></a><span class="co"># prepare a palette</span></span>
<span id="cb20-8"><a href="reducing-small-scale-error-and-aggregating-data.html#cb20-8"></a>pal &lt;-<span class="st"> </span>RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">4</span>, <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p>We load both the simulated, canonical data (which has no errors), as well as the data with errors which has been pre-processed to remove large-scale errors.</p>
<p>We also assign a variable, <code>window_size</code>, which will help identify the datasets when comparing median smooth moving window (<span class="math inline">\(K\)</span>) sizes.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="reducing-small-scale-error-and-aggregating-data.html#cb21-1"></a><span class="co"># read in the data and set the window size variable</span></span>
<span id="cb21-2"><a href="reducing-small-scale-error-and-aggregating-data.html#cb21-2"></a>data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/data_sim.csv&quot;</span>)[<span class="dv">5000</span><span class="op">:</span><span class="dv">10000</span>, ]</span>
<span id="cb21-3"><a href="reducing-small-scale-error-and-aggregating-data.html#cb21-3"></a>data[, window_size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NA</span>]</span>
<span id="cb21-4"><a href="reducing-small-scale-error-and-aggregating-data.html#cb21-4"></a></span>
<span id="cb21-5"><a href="reducing-small-scale-error-and-aggregating-data.html#cb21-5"></a><span class="co"># data with small scale errors but no reflections or outliers</span></span>
<span id="cb21-6"><a href="reducing-small-scale-error-and-aggregating-data.html#cb21-6"></a>data_errors &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/data_no_reflection.csv&quot;</span>)</span>
<span id="cb21-7"><a href="reducing-small-scale-error-and-aggregating-data.html#cb21-7"></a>data_errors[, window_size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">0</span>]</span></code></pre></div>
</div>
<div id="median-smoothing" class="section level2">
<h2><span class="header-section-number">4.2</span> Median Smoothing</h2>
<p>We apply a median smooth with four different values of <span class="math inline">\(K\)</span>, the moving window size — 3, 5, 11, and 21 positions.
<span class="math inline">\(K\)</span> must be an odd number, but apart from that there is no correct magnitude of <span class="math inline">\(K\)</span>.
Very large <span class="math inline">\(K\)</span> will lead to unrealistic tracks, while small <span class="math inline">\(K\)</span> will not result in much reduction of error.
Users are encouraged to plot their data before and after smoothing to examine the effect of different window sizes.</p>
<p>The <code>atlastools</code> function <code>atl_median_smooth</code> is quite fast and users can readily try multiple <span class="math inline">\(K\)</span> values as shown in the example below.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-1"></a><span class="co"># smooth the data over four K values</span></span>
<span id="cb22-2"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-2"></a>list_of_smooths &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">11</span>, <span class="dv">21</span>), <span class="cf">function</span>(K) {</span>
<span id="cb22-3"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-3"></a>  </span>
<span id="cb22-4"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-4"></a>  data_copy &lt;-<span class="st"> </span><span class="kw">copy</span>(data_errors)</span>
<span id="cb22-5"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-5"></a>  </span>
<span id="cb22-6"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-6"></a>  data_copy &lt;-<span class="st"> </span><span class="kw">atl_median_smooth</span>(<span class="dt">data =</span> data_copy,</span>
<span id="cb22-7"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-7"></a>                    <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, </span>
<span id="cb22-8"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-8"></a>                    <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb22-9"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-9"></a>                    <span class="dt">time =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb22-10"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-10"></a>                    <span class="dt">moving_window =</span> K)</span>
<span id="cb22-11"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-11"></a>  </span>
<span id="cb22-12"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-12"></a>  data_copy[, window_size <span class="op">:</span><span class="er">=</span><span class="st"> </span>K]</span>
<span id="cb22-13"><a href="reducing-small-scale-error-and-aggregating-data.html#cb22-13"></a>})</span></code></pre></div>
<p>We save the 11 point smoothed data.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="reducing-small-scale-error-and-aggregating-data.html#cb23-1"></a><span class="kw">fwrite</span>(list_of_smooths[[<span class="dv">3</span>]], <span class="dt">file =</span> <span class="st">&quot;data/data_smooth.csv&quot;</span>)</span></code></pre></div>
<p>We prepare the data for plotting.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="reducing-small-scale-error-and-aggregating-data.html#cb24-1"></a><span class="co"># bind list after offset</span></span>
<span id="cb24-2"><a href="reducing-small-scale-error-and-aggregating-data.html#cb24-2"></a>data_plot &lt;-<span class="st"> </span><span class="kw">mapply</span>(<span class="cf">function</span>(df, offset) {</span>
<span id="cb24-3"><a href="reducing-small-scale-error-and-aggregating-data.html#cb24-3"></a>  df[, x <span class="op">:</span><span class="er">=</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>offset]</span>
<span id="cb24-4"><a href="reducing-small-scale-error-and-aggregating-data.html#cb24-4"></a>}, list_of_smooths, <span class="kw">seq</span>(<span class="fl">0.4</span>, <span class="fl">1.25</span>, <span class="dt">length.out =</span> <span class="dv">4</span>),</span>
<span id="cb24-5"><a href="reducing-small-scale-error-and-aggregating-data.html#cb24-5"></a><span class="dt">SIMPLIFY =</span> F)</span>
<span id="cb24-6"><a href="reducing-small-scale-error-and-aggregating-data.html#cb24-6"></a></span>
<span id="cb24-7"><a href="reducing-small-scale-error-and-aggregating-data.html#cb24-7"></a>data_plot &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(data_plot)</span></code></pre></div>
<p>We prepare a plot of the smoothed data.</p>
</div>
<div id="thinning-data-by-aggregation" class="section level2">
<h2><span class="header-section-number">4.3</span> Thinning Data by Aggregation</h2>
<p>Evenly thinning data is a good idea if statistical methods require even sampling, or if the volume of data is too large for statistical packages to efficiently handle it. In <code>R</code>, both may be true at once.</p>
<p>Here, we demonstrate thinning by aggregation on data that has been median smoothed using a <span class="math inline">\(K\)</span> of 11.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-1"></a><span class="co"># choose the 11 point median smooth data</span></span>
<span id="cb25-2"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-2"></a>data_agg &lt;-<span class="st"> </span><span class="kw">copy</span>(list_of_smooths[[<span class="dv">3</span>]])</span>
<span id="cb25-3"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-3"></a></span>
<span id="cb25-4"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-4"></a><span class="co"># get list of aggregated data</span></span>
<span id="cb25-5"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-5"></a>list_of_agg &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">120</span>), <span class="cf">function</span>(z) {</span>
<span id="cb25-6"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-6"></a>  </span>
<span id="cb25-7"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-7"></a>  data_return &lt;-<span class="st"> </span><span class="kw">atl_thin_data</span>(<span class="dt">data =</span> data_agg,</span>
<span id="cb25-8"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-8"></a>                            <span class="dt">interval =</span> z,</span>
<span id="cb25-9"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-9"></a>                            <span class="dt">method =</span> <span class="st">&quot;aggregate&quot;</span>)</span>
<span id="cb25-10"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-10"></a>  </span>
<span id="cb25-11"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-11"></a>  data_return[, interval <span class="op">:</span><span class="er">=</span><span class="st"> </span>z]</span>
<span id="cb25-12"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-12"></a>  </span>
<span id="cb25-13"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-13"></a>  <span class="kw">return</span>(data_return)</span>
<span id="cb25-14"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-14"></a>})</span>
<span id="cb25-15"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-15"></a></span>
<span id="cb25-16"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-16"></a><span class="co"># get mean speed estimate and sd</span></span>
<span id="cb25-17"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-17"></a>speed_agg_smooth &lt;-<span class="st"> </span></span>
<span id="cb25-18"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-18"></a><span class="st">  </span><span class="kw">lapply</span>(list_of_agg, <span class="cf">function</span>(df) {</span>
<span id="cb25-19"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-19"></a>    <span class="kw">na.omit</span>(df)</span>
<span id="cb25-20"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-20"></a>    df[, speed <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">atl_get_speed</span>(df)]</span>
<span id="cb25-21"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-21"></a>    df[, <span class="kw">list</span>(<span class="dt">median =</span> <span class="kw">median</span>(speed, <span class="dt">na.rm =</span> T),</span>
<span id="cb25-22"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-22"></a>              <span class="dt">sd =</span> <span class="kw">sd</span>(speed, <span class="dt">na.rm =</span> T),</span>
<span id="cb25-23"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-23"></a>              <span class="dt">interval =</span> <span class="kw">first</span>(interval))]</span>
<span id="cb25-24"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-24"></a>  })</span>
<span id="cb25-25"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-25"></a></span>
<span id="cb25-26"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-26"></a><span class="co"># bind</span></span>
<span id="cb25-27"><a href="reducing-small-scale-error-and-aggregating-data.html#cb25-27"></a>speed_agg_smooth &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(speed_agg_smooth)</span></code></pre></div>
</div>
<div id="aggregation-before-reducing-positioning-errors" class="section level2">
<h2><span class="header-section-number">4.4</span> Aggregation Before Reducing Positioning Errors</h2>
<p>Users may rightly wonder whether they can get away with aggregating their data, using a median aggregation function, and reduce data volumes, correct uneven sampling frequency, and reduce large-scale errors all in one go.</p>
<p>The answer to most questions in ecology is, “It depends”. Median aggregation before correcting positioning errors can indeed be advantageous; for instance for faster visualisation while preserving the broad structure of a track.</p>
<p>However, there are drawbacks. The main one is that information is lost in the aggregation process, lending less power to steps such as smoothing applied after aggregation.
Further, aggregation (and indeed any kind of thinning) results in significantly different estimates of speed and distance from the real speed.</p>
<p>We show the effect of aggregating before any error correction here.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-1"></a><span class="co"># read data with errors</span></span>
<span id="cb26-2"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-2"></a>data_errors &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/data_errors.csv&quot;</span>)</span>
<span id="cb26-3"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-3"></a>  </span>
<span id="cb26-4"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-4"></a><span class="co"># aggregate before correction</span></span>
<span id="cb26-5"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-5"></a>list_of_agg &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">120</span>), <span class="cf">function</span>(z) {</span>
<span id="cb26-6"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-6"></a>  data_return &lt;-<span class="st"> </span><span class="kw">atl_thin_data</span>(<span class="dt">data =</span> data_errors,</span>
<span id="cb26-7"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-7"></a>                            <span class="dt">interval =</span> z,</span>
<span id="cb26-8"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-8"></a>                            <span class="dt">method =</span> <span class="st">&quot;aggregate&quot;</span>)</span>
<span id="cb26-9"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-9"></a>  data_return[, interval <span class="op">:</span><span class="er">=</span><span class="st"> </span>z]</span>
<span id="cb26-10"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-10"></a>  data_return[, speed <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">atl_get_speed</span>(data_return)]</span>
<span id="cb26-11"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-11"></a>  <span class="kw">return</span>(data_return)</span>
<span id="cb26-12"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-12"></a>})</span>
<span id="cb26-13"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-13"></a></span>
<span id="cb26-14"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-14"></a><span class="co"># get real speed</span></span>
<span id="cb26-15"><a href="reducing-small-scale-error-and-aggregating-data.html#cb26-15"></a>data[, speed <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">atl_get_speed</span>(data)]</span></code></pre></div>
<div id="comparing-median-aggregation-with-and-without-smoothing" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Comparing median aggregation with and without smoothing</h3>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="reducing-small-scale-error-and-aggregating-data.html#cb27-1"></a><span class="co"># now plot distribution of speed</span></span>
<span id="cb27-2"><a href="reducing-small-scale-error-and-aggregating-data.html#cb27-2"></a>data_agg &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(list_of_agg)</span></code></pre></div>
<p><img src="figures/fig_aggregate_errors.png" /></p>
<p>Thinning a movement track using median aggregation preserves track structure, but affects essential track metrics such as speed.
<strong>(a, b)</strong> Movement tracks with a canonical interval of 1s aggregated over intervals of <strong>(a)</strong> 10 and <strong>(b)</strong> 30 seconds, without removing large- or small-scale positioning errors. All symbols represent positions in the aggregated track, with the size of the symbol representing the standard deviation at each position.
Blue crosses represent positions with speed <span class="math inline">\(\leq\)</span> the 95^th percentile of canonical speeds, while red triangles represent positions with speed <span class="math inline">\(\geq\)</span> 95^th percentile of canonical speeds.
<strong>(c)</strong> Boxplot of instantaneous speeds after median aggregation of a 1s interval track over intervals of 3, 10, 30, and 120 seconds, but without the removal of positioning errors. The mean and 95^th percentile of speed in the canonical track are shown as solid and dashed lines, respectively.
Aggregation without reducing positioning errors can result in speed estimates that are substantially different from the true speed.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reducing-large-scale-positioning-error-by-filtering-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="residence-patches-and-their-construction.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
