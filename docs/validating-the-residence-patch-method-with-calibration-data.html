<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 1 Validating the Residence Patch Method with Calibration Data | Supplementary Material for A Guide to Pre-processing High-Frequency Animal Tracking Data</title>
  <meta name="description" content="Section 1 Validating the Residence Patch Method with Calibration Data | Supplementary Material for A Guide to Pre-processing High-Frequency Animal Tracking Data" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 1 Validating the Residence Patch Method with Calibration Data | Supplementary Material for A Guide to Pre-processing High-Frequency Animal Tracking Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Section 1 Validating the Residence Patch Method with Calibration Data | Supplementary Material for A Guide to Pre-processing High-Frequency Animal Tracking Data" />
  <meta name="github-repo" content="pratikunterwegs/atlas-best-practices" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 1 Validating the Residence Patch Method with Calibration Data | Supplementary Material for A Guide to Pre-processing High-Frequency Animal Tracking Data" />
  
  <meta name="twitter:description" content="Section 1 Validating the Residence Patch Method with Calibration Data | Supplementary Material for A Guide to Pre-processing High-Frequency Animal Tracking Data" />
  

<meta name="author" content="Pratik R. Gupte" />
<meta name="author" content="Christine E. Beardsworth" />
<meta name="author" content="Orr Spiegel" />
<meta name="author" content="Emmanuel Lourie" />
<meta name="author" content="Sivan Toledo" />
<meta name="author" content="Ran Nathan" />
<meta name="author" content="Allert I. Bijleveld" />


<meta name="date" content="2021-10-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="processing-egyptian-fruit-bat-tracks.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html"><i class="fa fa-check"></i><b>1</b> Validating the Residence Patch Method with Calibration Data</a><ul>
<li class="chapter" data-level="1.1" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#outline-of-cleaning-steps"><i class="fa fa-check"></i><b>1.1</b> Outline of Cleaning Steps</a></li>
<li class="chapter" data-level="1.2" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#install-atlastools-from-github"><i class="fa fa-check"></i><b>1.2</b> Install <code>atlastools</code> from Github</a><ul>
<li><a href="validating-the-residence-patch-method-with-calibration-data.html#a-note-on">A Note on <code>:=</code></a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#prepare-libraries"><i class="fa fa-check"></i><b>1.3</b> Prepare libraries</a></li>
<li class="chapter" data-level="1.4" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#access-data-and-preliminary-visualisation"><i class="fa fa-check"></i><b>1.4</b> Access data and preliminary visualisation</a></li>
<li class="chapter" data-level="1.5" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#filter-by-bounding-box"><i class="fa fa-check"></i><b>1.5</b> Filter by bounding box</a></li>
<li class="chapter" data-level="1.6" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#filter-trajectories"><i class="fa fa-check"></i><b>1.6</b> Filter trajectories</a><ul>
<li class="chapter" data-level="1.6.1" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#handle-time"><i class="fa fa-check"></i><b>1.6.1</b> Handle time</a></li>
<li class="chapter" data-level="1.6.2" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#add-speed-and-turning-angle"><i class="fa fa-check"></i><b>1.6.2</b> Add speed and turning angle</a></li>
<li class="chapter" data-level="1.6.3" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#get-90th-percentile-of-speed-and-angle"><i class="fa fa-check"></i><b>1.6.3</b> Get 90th percentile of speed and angle</a></li>
<li class="chapter" data-level="1.6.4" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#filter-on-speed"><i class="fa fa-check"></i><b>1.6.4</b> Filter on speed</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#smoothing-the-trajectory"><i class="fa fa-check"></i><b>1.7</b> Smoothing the trajectory</a></li>
<li class="chapter" data-level="1.8" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#thinning-the-data"><i class="fa fa-check"></i><b>1.8</b> Thinning the data</a></li>
<li class="chapter" data-level="1.9" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#residence-patches"><i class="fa fa-check"></i><b>1.9</b> Residence patches</a><ul>
<li class="chapter" data-level="1.9.1" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#get-waypoint-centroids"><i class="fa fa-check"></i><b>1.9.1</b> Get waypoint centroids</a></li>
<li class="chapter" data-level="1.9.2" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#prepare-data"><i class="fa fa-check"></i><b>1.9.2</b> Prepare data</a></li>
<li class="chapter" data-level="1.9.3" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#exclude-transit-points"><i class="fa fa-check"></i><b>1.9.3</b> Exclude transit points</a></li>
<li class="chapter" data-level="1.9.4" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#run-residence-patch-method"><i class="fa fa-check"></i><b>1.9.4</b> Run residence patch method</a></li>
<li class="chapter" data-level="" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#a-note-on-summary-statistics"><i class="fa fa-check"></i>A note on summary statistics</a></li>
<li class="chapter" data-level="1.9.5" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#get-spatial-and-summary-objects"><i class="fa fa-check"></i><b>1.9.5</b> Get spatial and summary objects</a></li>
<li class="chapter" data-level="1.9.6" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#prepare-to-plot-data"><i class="fa fa-check"></i><b>1.9.6</b> Prepare to plot data</a></li>
</ul></li>
<li class="chapter" data-level="1.10" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#compare-patch-metrics"><i class="fa fa-check"></i><b>1.10</b> Compare patch metrics</a><ul>
<li class="chapter" data-level="1.10.1" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#linear-model-durations"><i class="fa fa-check"></i><b>1.10.1</b> Linear model durations</a></li>
<li class="chapter" data-level="1.10.2" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#linear-model-summary"><i class="fa fa-check"></i><b>1.10.2</b> Linear model summary</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="validating-the-residence-patch-method-with-calibration-data.html"><a href="validating-the-residence-patch-method-with-calibration-data.html#main-text-figure-7"><i class="fa fa-check"></i><b>1.11</b> Main text Figure 7</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html"><i class="fa fa-check"></i><b>2</b> Processing Egyptian Fruit Bat Tracks</a><ul>
<li class="chapter" data-level="2.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#prepare-libraries-1"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="2.2" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#read-bat-data"><i class="fa fa-check"></i><b>2.2</b> Read bat data</a></li>
<li class="chapter" data-level="2.3" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#exploratory-data-analysis-panels-main-text-figure-1"><i class="fa fa-check"></i><b>2.3</b> Exploratory Data Analysis Panels: Main Text Figure 1</a><ul>
<li class="chapter" data-level="2.3.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#heatmap-of-locations"><i class="fa fa-check"></i><b>2.3.1</b> Heatmap of Locations</a></li>
<li class="chapter" data-level="2.3.2" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sampling-intervals"><i class="fa fa-check"></i><b>2.3.2</b> Sampling Intervals</a></li>
<li class="chapter" data-level="2.3.3" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#localisation-error-measured-by-systems"><i class="fa fa-check"></i><b>2.3.3</b> Localisation Error Measured by Systems</a></li>
<li class="chapter" data-level="2.3.4" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#plot-paths-from-raw-tracking-data"><i class="fa fa-check"></i><b>2.3.4</b> Plot paths from raw tracking data</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#prepare-data-for-filtering"><i class="fa fa-check"></i><b>2.4</b> Prepare data for filtering</a><ul>
<li class="chapter" data-level="2.4.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#prepare-data-per-individual"><i class="fa fa-check"></i><b>2.4.1</b> Prepare data per individual</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#filter-by-system-generated-error-attributes"><i class="fa fa-check"></i><b>2.5</b> Filter by system-generated error attributes</a><ul>
<li class="chapter" data-level="2.5.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sanity-check-plot-filtered-data"><i class="fa fa-check"></i><b>2.5.1</b> Sanity check: Plot filtered data</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#filter-by-speed"><i class="fa fa-check"></i><b>2.6</b> Filter by speed</a><ul>
<li class="chapter" data-level="2.6.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sanity-check-plot-speed-filtered-data"><i class="fa fa-check"></i><b>2.6.1</b> Sanity check: Plot speed filtered data</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#median-smoothing"><i class="fa fa-check"></i><b>2.7</b> Median smoothing</a><ul>
<li class="chapter" data-level="2.7.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#sanity-check-plot-smoothed-data"><i class="fa fa-check"></i><b>2.7.1</b> Sanity check: Plot smoothed data</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#making-residence-patches"><i class="fa fa-check"></i><b>2.8</b> Making residence patches</a><ul>
<li class="chapter" data-level="2.8.1" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#calculating-residence-time"><i class="fa fa-check"></i><b>2.8.1</b> Calculating residence time</a></li>
<li class="chapter" data-level="2.8.2" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#movements-away-from-the-roost"><i class="fa fa-check"></i><b>2.8.2</b> Movements away from the roost</a></li>
<li class="chapter" data-level="2.8.3" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#split-data-by-night-id"><i class="fa fa-check"></i><b>2.8.3</b> Split data by night-id</a></li>
<li class="chapter" data-level="2.8.4" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#constructing-residence-patches"><i class="fa fa-check"></i><b>2.8.4</b> Constructing residence patches</a></li>
<li class="chapter" data-level="2.8.5" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#getting-residence-patch-data"><i class="fa fa-check"></i><b>2.8.5</b> Getting residence patch data</a></li>
<li class="chapter" data-level="2.8.6" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#write-patch-spatial-representations"><i class="fa fa-check"></i><b>2.8.6</b> Write patch spatial representations</a></li>
<li class="chapter" data-level="2.8.7" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#duration-at-foraging-sites"><i class="fa fa-check"></i><b>2.8.7</b> Duration at foraging sites</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="processing-egyptian-fruit-bat-tracks.html"><a href="processing-egyptian-fruit-bat-tracks.html#main-text-figure-8"><i class="fa fa-check"></i><b>2.9</b> Main text Figure 8</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>3</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Supplementary Material for <em>A Guide to Pre-processing High-Frequency Animal Tracking Data</em></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="validating-the-residence-patch-method-with-calibration-data" class="section level1">
<h1><span class="header-section-number">Section 1</span> Validating the Residence Patch Method with Calibration Data</h1>
<p>Here we show how the residence patch method <span class="citation">(Barraquand and Benhamou <a href="#ref-barraquand2008">2008</a>; Bijleveld et al. <a href="#ref-bijleveld2016">2016</a>; Oudman et al. <a href="#ref-oudman2018">2018</a>)</span> accurately estimates the duration of known stops in a track collected as part of a calibration exercise in the Wadden Sea. These data can be accessed from the <code>data</code> folder at this link: <a href="https://doi.org/10.5281/zenodo.4287462" class="uri">https://doi.org/10.5281/zenodo.4287462</a>. These data are more fully reported in <span class="citation">(Beardsworth et al. <a href="#ref-beardsworth2021">2021</a>)</span>.</p>
<div id="outline-of-cleaning-steps" class="section level2">
<h2><span class="header-section-number">1.1</span> Outline of Cleaning Steps</h2>
<p>We begin by preparing the libraries we need, and installing <code>atlastools</code> from Github.
After installing <code>atlastools</code>, we visualise the data to check for location errors, and find a single outlier position approx. 15km away from the study area (Fig. 1.1, 1.2).
This outlier is removed by filtering data by the X coordinate bounds using the function <code>atl_filter_bounds</code>; X coordinate bounds <span class="math inline">\(\leq\)</span> 645,000 in the UTM 31N coordinate reference system were removed (n = 1; remaining positions = 50,815; Fig. 1.2).
We then calculate the incoming and outgoing speed, as well as the turning angle at each position using the functions <code>atl_get_speed</code> and <code>atl_turning_angle</code> respectively, as a precursor to targeting large-scale location errors in the form of point outliers.
We use the function <code>atl_filter_covariates</code> to remove positions with incoming and outgoing speeds <span class="math inline">\(\geq\)</span> the speed threshold of 15 m/s (n = 13,491, 26.5%; remaining positions = 37,324, 73.5%; Fig. 1.3; main text Fig. 7.b).
This speed threshold is chosen as the fastest boat speed during the experiment, 15 m/s.
Finally, we target small-scale location errors by applying a median smoother with a moving window size <span class="math inline">\(K\)</span> = 5 using the function <code>atl_median_smooth</code> (Fig. 1.4; main text Fig. 7.c).
Smoothing does not reduce the number of positions.
We thin the data to a 30 second interval leaving 1,803 positions (4.8% positions of the smoothed track)</p>
</div>
<div id="install-atlastools-from-github" class="section level2">
<h2><span class="header-section-number">1.2</span> Install <code>atlastools</code> from Github</h2>
<p><code>atlastools</code> is available from Github and is archived on Zenodo <span class="citation">(Gupte <a href="#ref-gupte2020a">2020</a>)</span>.
It can be installed using <code>remotes</code> or <code>devtools</code>. Here we use the <code>remotes</code> function <code>install_github</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(remotes)) {</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">  <span class="kw">install.packages</span>(<span class="st">&quot;remotes&quot;</span>, <span class="dt">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># installation using remotes</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(atlastools)) {</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;pratikunterwegs/atlastools&quot;</span>, <span class="dt">upgrade =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">}</a></code></pre></div>
<div id="a-note-on" class="section level3 unnumbered">
<h3>A Note on <code>:=</code></h3>
<p>The <code>atlastools</code> package is based on <code>data.table</code>, to be fast and efficient <span class="citation">(Dowle and Srinivasan <a href="#ref-dowle2020">2020</a>)</span>.
A key feature is modification in place, where data is changed without making a copy.
This is already implemented in <code>R</code> and will be familiar to many users as <code>data_frame$column_name &lt;- values</code>.</p>
<p>The <code>data.table</code> way of writing this assignment would be <code>data_frame[, column_name := values]</code>.
We use this syntax throughout, as it provides many useful shortcuts, such as multiple assignment:</p>
<p><code>data_frame[, c(&quot;col_a&quot;, &quot;col_b&quot;) := list(values_a, values_b)]</code></p>
<p>Users can use this special syntax, and will find it convenient with practice, but there are <em>no</em> cases where users <em>must</em> use the <code>data.table</code> syntax, and can simply treat the data as a regular <code>data.frame</code>. However, users are advised to convert their <code>data.frame</code> to a <code>data.table</code> using the function <code>data.table::setDT()</code>.</p>
</div>
</div>
<div id="prepare-libraries" class="section level2">
<h2><span class="header-section-number">1.3</span> Prepare libraries</h2>
<p>First we prepare the libraries we need. Libraries can be installed from CRAN if necessary.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># for data handling</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">library</span>(atlastools)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(stringi)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># for recursion analysis</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="kw">library</span>(recurse)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># for plotting</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co"># making a colour palette</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">pal &lt;-<span class="st"> </span>RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">5</span>, <span class="st">&quot;Set1&quot;</span>)</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">pal[<span class="dv">3</span>] &lt;-<span class="st"> &quot;seagreen&quot;</span></a></code></pre></div>
</div>
<div id="access-data-and-preliminary-visualisation" class="section level2">
<h2><span class="header-section-number">1.4</span> Access data and preliminary visualisation</h2>
<p>First we access the data from a local file using the <code>data.table</code> package <span class="citation">(Dowle and Srinivasan <a href="#ref-dowle2020">2020</a>)</span>.</p>
<p>In all, we aim to keep three versions of the data: (1) <code>data_raw</code>, the entirely unprocessed data, (2) <code>data</code>, the working version, and (3) <code>data_unproc</code>, data that has been partially processed, but which is one step behind <code>data</code>. This allows us to better illustrate the pre-processing steps, and prevents us from irreversibly modifying our data — at best, we would have to re-run many pre-processing steps, and at worst, we might overwrite the original data on disk.</p>
<p>We look at the first few rows, using <code>head()</code>. We then visualise the raw data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># read and plot example data</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/atlas1060_allTrials_annotated.csv&quot;</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">data_raw &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"># see raw data</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">head</span>(data_raw)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;            TAG          TIME NBS VARX VARY COVXY   SD           Timestamp</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; 1: 31001001060 1598027365845   6 6.28 2.85 1.682 3.53 2020-08-21 17:29:25</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; 2: 31001001060 1598027366845   6 2.23 2.23 0.277 2.24 2020-08-21 17:29:26</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; 3: 31001001060 1598027367845   6 2.94 2.82 0.612 2.64 2020-08-21 17:29:27</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; 4: 31001001060 1598027368845   6 8.45 3.68 2.734 4.20 2020-08-21 17:29:28</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; 5: 31001001060 1598027369845   5 6.80 3.26 2.273 3.82 2020-08-21 17:29:29</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; 6: 31001001060 1598027370845   6 3.95 2.94 0.983 2.98 2020-08-21 17:29:30</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt;            id      x       y Long  Lat             UTCtime    tID</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; 1: 2020-08-21 650083 5902624 5.25 53.3 2020-08-21 16:29:25 DELETE</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; 2: 2020-08-21 650083 5902624 5.25 53.3 2020-08-21 16:29:26 DELETE</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt; 3: 2020-08-21 650073 5902622 5.25 53.3 2020-08-21 16:29:27 DELETE</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; 4: 2020-08-21 650079 5902625 5.25 53.3 2020-08-21 16:29:28 DELETE</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; 5: 2020-08-21 650067 5902621 5.25 53.3 2020-08-21 16:29:29 DELETE</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt; 6: 2020-08-21 650071 5902621 5.25 53.3 2020-08-21 16:29:30 DELETE</span></a></code></pre></div>
<p>Here we show how data can be easily visualised using the popular plotting package <code>ggplot2</code>.
Note that we plot both the points (<code>geom_point</code>) and the inferred path between them (<code>geom_path</code>), and specify a geospatial coordinate system in metres, suitable for the Dutch Wadden Sea (UTM 31N; ESPG code:32631; <code>coord_sf</code>).
We save the output to file for future reference.</p>
<p>Since plot code can become very lengthy and complicated, we omit showing further plot code in versions of this document rendered as PDF or HTML; it can however be seen in the online <code>.Rmd</code> version.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># plot data</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">fig_data_raw &lt;-</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(data) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">    <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> <span class="fl">0.2</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">0.2</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_few</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">    <span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">    <span class="dt">axis.text =</span> <span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">32631</span>)</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co"># save figure</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="kw">ggsave</span>(fig_data_raw,</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">  <span class="dt">filename =</span> <span class="st">&quot;supplement/figures/fig_calibration_raw.png&quot;</span>,</a>
<a class="sourceLine" id="cb4-20" data-line-number="20">  <span class="dt">width =</span> <span class="dv">185</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21">)</a></code></pre></div>
<div class="figure">
<img src="figures/fig_calibration_raw.png" alt="The raw data from a calibration exercise conducted around the island of Griend in the Dutch Wadden Sea. A handheld WATLAS tag was used to examine how ATLAS data compared to GPS tracks, and we use the WATLAS data here to demonstrate the basics of the pre-processing pipeline, as well as validate the residence patch method. It is immediately clear from the figure that the track shows location errors, both in the form of point outliers as well as small-scale errors around the true location." />
<p class="caption">The raw data from a calibration exercise conducted around the island of Griend in the Dutch Wadden Sea. A handheld WATLAS tag was used to examine how ATLAS data compared to GPS tracks, and we use the WATLAS data here to demonstrate the basics of the pre-processing pipeline, as well as validate the residence patch method. It is immediately clear from the figure that the track shows location errors, both in the form of point outliers as well as small-scale errors around the true location.</p>
</div>
</div>
<div id="filter-by-bounding-box" class="section level2">
<h2><span class="header-section-number">1.5</span> Filter by bounding box</h2>
<p>We first save a copy of the data, so that we can plot the unprocessed data with the cleaned data plotted over it for comparison. Here, <code>data_unproc</code>, <code>data</code>, and <code>data_raw</code> are still the same, since no pre-processing steps have been applied yet.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># make a copy using the data.table copy function</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a></code></pre></div>
<p>We then filter by a bounding box in order to remove the point outlier to the far south east of the main track. We use the <code>atl_filter_bounds</code> functions using the <code>x_range</code> argument, to which we pass the limit in the UTM 31N coordinate reference system.
This limit is used to exclude all points with an X coordinate &lt; 645,000.</p>
<p>We then plot the result of filtering, with the excluded point in black, and the points that are retained in green. After this stage, <code>data</code> is filtered and ‘ahead’ of <code>data_raw</code> and <code>data_unproc</code>, which are still the same. This pattern will repeat throughout this material.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># remove inside must be set to falses</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">data &lt;-<span class="st"> </span><span class="kw">atl_filter_bounds</span>(</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="dt">x_range =</span> <span class="kw">c</span>(<span class="dv">645000</span>, <span class="kw">max</span>(data<span class="op">$</span>x)),</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  <span class="dt">remove_inside =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">)</a></code></pre></div>
<div class="figure">
<img src="figures/fig_calib_bbox.png" alt="Removal of a point outlier using the function atl_filter_bounds. The point outlier (black point) is removed based on its X coordinate value, with the data filtered to exclude positions with an X coordinate &lt; 645,000 in the UTM 31N coordinate system. Positions that are retained are shown in green." />
<p class="caption">Removal of a point outlier using the function <code>atl_filter_bounds</code>. The point outlier (black point) is removed based on its X coordinate value, with the data filtered to exclude positions with an X coordinate &lt; 645,000 in the UTM 31N coordinate system. Positions that are retained are shown in green.</p>
</div>
</div>
<div id="filter-trajectories" class="section level2">
<h2><span class="header-section-number">1.6</span> Filter trajectories</h2>
<div id="handle-time" class="section level3">
<h3><span class="header-section-number">1.6.1</span> Handle time</h3>
<p>Time in ATLAS tracks is represented by 64-bit integers (type <code>long</code>) that specify time in milliseconds, starting from the beginning of 1970 (the UNIX epoch). This representation of time is called <code>POSIX</code> time and is usually specified in seconds, not milliseconds.</p>
<p>Since about 1.6 billion seconds have passed since the beginning of 1970, current <code>POSIX</code> times in milliseconds cannot be represented by R’s built-in 32-bit integers. A naive conversion results in truncation of out-of-range numbers leading to huge errors (dates many thousands of years in the future).</p>
<p>R does not natively support 64-bit integers. One option is to use the bit64 package, which adds 64-bit integer support to R.</p>
<p>A simpler solution is to convert the times to R’s built in <code>double</code> data type (also called <code>numeric</code>), which uses a 64-bit floating point representation. This representation can represent integers with up to 16 digits without error; we only need 13 digits to represent the number of milliseconds since 1970, so the conversion is error free. We can also perform the conversion and then divide by 1000 so that times are represented in seconds, not milliseconds; this simplifies speed estimation.</p>
<p>If second-resolution is accurate enough (it is for our purposes), the solution that we use is to divide times by 1000 to reduce the resolution from milliseconds to seconds and then to convert the time stamps to R integers.
In the spirit of not destroying data, we create a second lower-case column called <code>time</code> to store this</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># divide by 1000, convert to integer</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">data[, time <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="kw">as.numeric</span>(TIME) <span class="op">/</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">)]</a></code></pre></div>
</div>
<div id="add-speed-and-turning-angle" class="section level3">
<h3><span class="header-section-number">1.6.2</span> Add speed and turning angle</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># add incoming and outgoing speed</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">data[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="dt">speed_in =</span> <span class="kw">atl_get_speed</span>(data,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="dt">time =</span> <span class="st">&quot;time&quot;</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  ),</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  <span class="dt">speed_out =</span> <span class="kw">atl_get_speed</span>(data, <span class="dt">type =</span> <span class="st">&quot;out&quot;</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">)]</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co"># add turning angle</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12">data[, angle <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">atl_turning_angle</span>(<span class="dt">data =</span> data)]</a></code></pre></div>
<p>Compare number of receivers and SD and speed.</p>
</div>
<div id="get-90th-percentile-of-speed-and-angle" class="section level3">
<h3><span class="header-section-number">1.6.3</span> Get 90th percentile of speed and angle</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># use sapply</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">speed_angle_thresholds &lt;-</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">sapply</span>(data[, <span class="kw">list</span>(speed_in, speed_out, angle)],</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    quantile,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="dt">probs =</span> <span class="fl">0.9</span>, <span class="dt">na.rm =</span> T</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  )</a></code></pre></div>
</div>
<div id="filter-on-speed" class="section level3">
<h3><span class="header-section-number">1.6.4</span> Filter on speed</h3>
<p>Here we use a speed threshold of 15 m/s, the fastest known boat speed.
We then plot the data with the extreme speeds shown in grey, and the positions retained shown in green.</p>
<p>Here, <code>data_unproc</code> moves ‘ahead’ of <code>data_raw</code>, and holds the data filtered by a bounding box — <code>data</code> is also moving ahead, and will be filtered on speed.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># make a copy</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"># remove speed outliers</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">data &lt;-<span class="st"> </span><span class="kw">atl_filter_covariates</span>(</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  <span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;(speed_in &lt; 15 &amp; speed_out &lt; 15)&quot;</span>)</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co"># recalculate speed and angle</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11">data[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">  <span class="dt">speed_in =</span> <span class="kw">atl_get_speed</span>(data,</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">    <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>,</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">    <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>,</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">    <span class="dt">time =</span> <span class="st">&quot;time&quot;</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16">  ),</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">  <span class="dt">speed_out =</span> <span class="kw">atl_get_speed</span>(data, <span class="dt">type =</span> <span class="st">&quot;out&quot;</span>)</a>
<a class="sourceLine" id="cb10-18" data-line-number="18">)]</a>
<a class="sourceLine" id="cb10-19" data-line-number="19"></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co"># add turning angle</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21">data[, angle <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">atl_turning_angle</span>(<span class="dt">data =</span> data)]</a></code></pre></div>
<div class="figure">
<img src="figures/fig_speed_outlier.png" alt="Improving data quality by filtering out positions that would require unrealistic movement. We removed positions with speeds \geq 15 m/s, which is the fastest possible speed in this calibration data, part of which was collected in a moving boat around Griend. Grey positions are removed, while green positions are retained. Rectangles indicate areas expanded for visualisation in following figures." />
<p class="caption">Improving data quality by filtering out positions that would require unrealistic movement. We removed positions with speeds <span class="math inline">\(\geq\)</span> 15 m/s, which is the fastest possible speed in this calibration data, part of which was collected in a moving boat around Griend. Grey positions are removed, while green positions are retained. Rectangles indicate areas expanded for visualisation in following figures.</p>
</div>
</div>
</div>
<div id="smoothing-the-trajectory" class="section level2">
<h2><span class="header-section-number">1.7</span> Smoothing the trajectory</h2>
<p>We then apply a median smooth over a moving window (<span class="math inline">\(K\)</span> = 5).
This function modifies in place, and does not need to be assigned to a new variable.
We create a copy of the data before applying the smooth so that we can compare the data before and after smoothing.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># apply a 5 point median smooth, first make a copy</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co"># now apply the smooth</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw">atl_median_smooth</span>(</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  <span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">time =</span> <span class="st">&quot;time&quot;</span>,</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  <span class="dt">moving_window =</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9">)</a></code></pre></div>
<div class="figure">
<img src="figures/fig_calib_median_smooth.png" alt="Reducing small-scale location error using a median smooth with a moving window K = 5. Median smoothed positions are shown in green, while raw, unfiltered data is shown in grey. Median smoothing successfully recovers the likely path of the track without a loss of data. The area shown is the upper rectangle from Fig. 1.3." />
<p class="caption">Reducing small-scale location error using a median smooth with a moving window <span class="math inline">\(K\)</span> = 5. Median smoothed positions are shown in green, while raw, unfiltered data is shown in grey. Median smoothing successfully recovers the likely path of the track without a loss of data. The area shown is the upper rectangle from Fig. 1.3.</p>
</div>
</div>
<div id="thinning-the-data" class="section level2">
<h2><span class="header-section-number">1.8</span> Thinning the data</h2>
<p>Next we thin the data by aggregation to demonstrate thinning after median smoothing.
Following this, we plot the median smooth and thinning by aggregation.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># save a copy</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co"># remove columns we don&#39;t need</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">data &lt;-<span class="st"> </span>data[, <span class="op">!</span><span class="kw">c</span>(<span class="st">&quot;tID&quot;</span>, <span class="st">&quot;Timestamp&quot;</span>, <span class="st">&quot;id&quot;</span>, <span class="st">&quot;TIME&quot;</span>, <span class="st">&quot;UTCtime&quot;</span>)]</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co"># thin to a 30s interval</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">data_thin &lt;-<span class="st"> </span><span class="kw">atl_thin_data</span>(</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">  <span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  <span class="dt">interval =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">  <span class="dt">method =</span> <span class="st">&quot;aggregate&quot;</span>,</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">  <span class="dt">id_columns =</span> <span class="st">&quot;TAG&quot;</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">)</a></code></pre></div>
<div class="figure">
<img src="figures/fig_calib_smooth_thin.png" alt="Thinning by aggregation over a 30 second interval (down from 1 second) preserves track structure while reducing the data volume for computation. Here, thinned positions are shown as purple squares, with the size of the square indicating the number of positions within the 30 second bin used to obtain the average position. Green points show the median smoothed data from Fig. 1.4, while the raw data are shown in grey. The area shown is the upper rectangle in Fig. 1.3." />
<p class="caption">Thinning by aggregation over a 30 second interval (down from 1 second) preserves track structure while reducing the data volume for computation. Here, thinned positions are shown as purple squares, with the size of the square indicating the number of positions within the 30 second bin used to obtain the average position. Green points show the median smoothed data from Fig. 1.4, while the raw data are shown in grey. The area shown is the upper rectangle in Fig. 1.3.</p>
</div>
</div>
<div id="residence-patches" class="section level2">
<h2><span class="header-section-number">1.9</span> Residence patches</h2>
<div id="get-waypoint-centroids" class="section level3">
<h3><span class="header-section-number">1.9.1</span> Get waypoint centroids</h3>
<p>We subset the annotated calibration data to select the waypoints and the positions around them which are supposed to be the locations of known stops. Since each stop was supposed to be 5 minutes long, there are multiple points in each known stop.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">data_res &lt;-<span class="st"> </span>data_unproc[<span class="kw">stri_detect</span>(tID, <span class="dt">regex =</span> <span class="st">&quot;(WP)&quot;</span>)]</a></code></pre></div>
<p>From this data, we get the centroid of known stops, and determine the time difference between the first and last point within 50 metres, and within 10 minutes of the waypoint positions’ median time.</p>
<p>Essentially, this means that the maximum duration of a stop can be 20 minutes, and stops above this duration are not expected.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># get centroid</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">data_res_summary &lt;-<span class="st"> </span>data_res[, <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">  <span class="dt">nfixes_real =</span> .N,</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">  <span class="dt">x_median =</span> <span class="kw">median</span>(x),</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">  <span class="dt">y_median =</span> <span class="kw">median</span>(y),</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">  <span class="dt">t_median =</span> <span class="kw">median</span>(time)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">),</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">by =<span class="st"> &quot;tID&quot;</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9">]</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co"># now get times 10 mins before and after</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12">data_res_summary[, <span class="kw">c</span>(<span class="st">&quot;t_min&quot;</span>, <span class="st">&quot;t_max&quot;</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">  t_median <span class="op">-</span><span class="st"> </span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>),</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">  t_median <span class="op">+</span><span class="st"> </span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">)]</a>
<a class="sourceLine" id="cb14-16" data-line-number="16"></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co"># manually get the duration of the stops</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18">wp_data &lt;-<span class="st"> </span><span class="kw">mapply</span>(<span class="cf">function</span>(l, u, mx, my) {</a>
<a class="sourceLine" id="cb14-19" data-line-number="19"></a>
<a class="sourceLine" id="cb14-20" data-line-number="20">  <span class="co"># first select all data whose timestamp is between</span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21">  <span class="co"># the upper and lower bounds of the stop (l = lower, u = upper)</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22">  tmp_data &lt;-<span class="st"> </span>data_unproc[<span class="kw">inrange</span>(time, l, u), ]</a>
<a class="sourceLine" id="cb14-23" data-line-number="23"></a>
<a class="sourceLine" id="cb14-24" data-line-number="24">  <span class="co"># calculate the distance between the positions selected above</span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25">  <span class="co"># and the median X and Y coordinates of the stop (centroid)</span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26">  tmp_data[, distance <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">sqrt</span>((mx <span class="op">-</span><span class="st"> </span>x)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(my <span class="op">-</span><span class="st"> </span>y)<span class="op">^</span><span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb14-27" data-line-number="27"></a>
<a class="sourceLine" id="cb14-28" data-line-number="28">  <span class="co"># keep positions that are within 50m of the centroid</span></a>
<a class="sourceLine" id="cb14-29" data-line-number="29">  tmp_data &lt;-<span class="st"> </span>tmp_data[distance <span class="op">&lt;=</span><span class="st"> </span><span class="dv">50</span>, ]</a>
<a class="sourceLine" id="cb14-30" data-line-number="30"></a>
<a class="sourceLine" id="cb14-31" data-line-number="31">  <span class="co"># get the duration of the stop as the difference between</span></a>
<a class="sourceLine" id="cb14-32" data-line-number="32">  <span class="co"># the minimum and maximum times of the positions retained above</span></a>
<a class="sourceLine" id="cb14-33" data-line-number="33">  <span class="kw">return</span>(<span class="kw">diff</span>(<span class="kw">range</span>(tmp_data<span class="op">$</span>time)))</a>
<a class="sourceLine" id="cb14-34" data-line-number="34">}, data_res_summary<span class="op">$</span>t_min, data_res_summary<span class="op">$</span>t_max,</a>
<a class="sourceLine" id="cb14-35" data-line-number="35">data_res_summary<span class="op">$</span>x_median, data_res_summary<span class="op">$</span>y_median,</a>
<a class="sourceLine" id="cb14-36" data-line-number="36"></a>
<a class="sourceLine" id="cb14-37" data-line-number="37"><span class="co"># this specifies that a vector, rather than a list, is returned</span></a>
<a class="sourceLine" id="cb14-38" data-line-number="38"><span class="dt">SIMPLIFY =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb14-39" data-line-number="39">)</a>
<a class="sourceLine" id="cb14-40" data-line-number="40"></a>
<a class="sourceLine" id="cb14-41" data-line-number="41"><span class="co"># get waypoint summary --- rounding median coordinates to the nearest 100m</span></a>
<a class="sourceLine" id="cb14-42" data-line-number="42">patch_summary_real &lt;-<span class="st"> </span>data_res_summary[, <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-43" data-line-number="43">  <span class="dt">nfixes_real =</span> nfixes_real,</a>
<a class="sourceLine" id="cb14-44" data-line-number="44">  <span class="dt">x_median =</span> <span class="kw">round</span>(<span class="kw">median</span>(x_median), <span class="dt">digits =</span> <span class="dv">-2</span>),</a>
<a class="sourceLine" id="cb14-45" data-line-number="45">  <span class="dt">y_median =</span> <span class="kw">round</span>(<span class="kw">median</span>(y_median), <span class="dt">digits =</span> <span class="dv">-2</span>)</a>
<a class="sourceLine" id="cb14-46" data-line-number="46">),</a>
<a class="sourceLine" id="cb14-47" data-line-number="47">by =<span class="st"> &quot;tID&quot;</span></a>
<a class="sourceLine" id="cb14-48" data-line-number="48">]</a>
<a class="sourceLine" id="cb14-49" data-line-number="49"></a>
<a class="sourceLine" id="cb14-50" data-line-number="50"><span class="co"># add real duration</span></a>
<a class="sourceLine" id="cb14-51" data-line-number="51">patch_summary_real[, duration_real <span class="op">:</span><span class="er">=</span><span class="st"> </span>wp_data]</a>
<a class="sourceLine" id="cb14-52" data-line-number="52"></a>
<a class="sourceLine" id="cb14-53" data-line-number="53"><span class="co"># write to file</span></a>
<a class="sourceLine" id="cb14-54" data-line-number="54"><span class="kw">fwrite</span>(patch_summary_real, <span class="st">&quot;data/data_real_watlas_stops.csv&quot;</span>)</a></code></pre></div>
</div>
<div id="prepare-data" class="section level3">
<h3><span class="header-section-number">1.9.2</span> Prepare data</h3>
<p>First, we filter data where we know the animal (or in this case, the human-carried tag) spent some time at or near a position, as this is the first step to identify residence patches.
One way of doing this is by filtering out positions with speeds above which the tag (ideally on an animal) is likely to be in transit.
Rather than filtering on instantaneous speed estimates, filtering on a median smoothed speed estimate is more reliable.</p>
</div>
<div id="exclude-transit-points" class="section level3">
<h3><span class="header-section-number">1.9.3</span> Exclude transit points</h3>
<p>Here, we aim to remove locations where the tag is clearly moving, by filtering on smoothed speed, using a one-way median smooth with <span class="math inline">\(K\)</span> = 5.
The speeds between points must be recalculated here because the speed metrics now associated with the data refer to the raw data before median smoothing.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># get 4 column data</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">data_for_patch &lt;-<span class="st"> </span><span class="kw">copy</span>(data_thin)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co"># recalculate speeds, removing speed out</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">data_for_patch[, <span class="kw">c</span>(<span class="st">&quot;speed_in&quot;</span>, <span class="st">&quot;speed_out&quot;</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">  <span class="kw">atl_get_speed</span>(data_for_patch),</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">  <span class="ot">NULL</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">)]</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co"># get smoothed speed</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11">data_for_patch[, speed_smooth <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">runmed</span>(speed_in, <span class="dt">k =</span> <span class="dv">5</span>)]</a>
<a class="sourceLine" id="cb15-12" data-line-number="12"></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co"># save recurse data</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="kw">fwrite</span>(data_for_patch, <span class="dt">file =</span> <span class="st">&quot;data/data_calib_for_patch.csv&quot;</span>)</a></code></pre></div>
</div>
<div id="run-residence-patch-method" class="section level3">
<h3><span class="header-section-number">1.9.4</span> Run residence patch method</h3>
<p>We subset data with a smoothed speed &lt; 2 m/s in order to construct residence patches.
From this subset, we construct residence patches using the parameters: <code>buffer_radius</code> = 5 metres, <code>lim_spat_indep</code> = 50 metres, <code>lim_time_indep</code> = 5 minutes, and <code>min_fixes</code> = 3.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># assign id as tag</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">data_for_patch[, id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(TAG)]</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co"># on known residence points</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">patch_res_known &lt;-<span class="st"> </span><span class="kw">atl_res_patch</span>(</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">  <span class="dt">data =</span> data_for_patch[speed_smooth <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, ],</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">  <span class="dt">buffer_radius =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">  <span class="dt">lim_spat_indep =</span> <span class="dv">50</span>,</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">  <span class="dt">lim_time_indep =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">  <span class="dt">min_fixes =</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">)</a></code></pre></div>
</div>
<div id="a-note-on-summary-statistics" class="section level3 unnumbered">
<h3>A note on summary statistics</h3>
<p>Users specifying a <code>summary_variable</code> should make sure that the variable for which they want a summary statistic is present in the data.
For instance, requesting mean speed by passing <code>summary_variable = &quot;speed&quot;</code> and <code>summary_function = &quot;mean&quot;</code> to <code>atl_res_patch</code>, should make sure that their data includes a column called <code>speed</code>.</p>
</div>
<div id="get-spatial-and-summary-objects" class="section level3">
<h3><span class="header-section-number">1.9.5</span> Get spatial and summary objects</h3>
<p>Having classified slow-moving or stationary behavioural bouts into residence patches, many animal ecologists would most probably wish to know something about the environment at or around these patches — more accurately, around the point locations classified into patches.</p>
<p>How exactly this is done depends on the relative spatial scales of the residence patches and the resolution of the environmental data layer.
For instance, a residence patch some 40m – 50m wide or long may be overlaid on an environmental raster layer with a resolution of 250m.
In this case, sampling the layer at the centroid of the patch is as good as sampling at all the patch’s points – the mean is unlikely to differ (except at raster pixel boundaries).</p>
<p>On the other hand, a raster with a 10m resolution (e.g. Sentinel 1 and 2 data) may be worthwhile to sample at all the locations comprising a residence patch, so as to calculate the mean and variance of environmental conditions.</p>
<p>Furthermore, many (if not all) animals integrate cues from quite a distance (10m – 100m) when making decisions on when to settle in an area, and when to leave. Thus it can also be useful to sample environmental layers not at point locations, but to extract the mean and variance from an <em>area</em>, or a buffer, around the animal’s point locations.</p>
<p>We have provided a convenient function to get either <em>(1)</em> the points (classified into patches), or <em>(2)</em> a summary ouput of the residence patches (i.e., the median coordinates and their attributes), or finally <em>(3)</em> a spatial buffer around the points from <em>(1)</em>.
This function, <code>atl_patch_summary</code> implements these options using the <code>which_data</code> argument, where the options are <em>(1)</em> “points”, <em>(2)</em> “summary”, or <em>(3)</em> “spatial”.</p>
<p>Here, we choose option (3), using a spatial buffer of 20m. The distance of the bufffer is passed to the argument <code>buffer_radius</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># for the known and unkniwn patches</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">patch_sf_data &lt;-<span class="st"> </span><span class="kw">atl_patch_summary</span>(patch_res_known,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="dt">which_data =</span> <span class="st">&quot;spatial&quot;</span>,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  <span class="dt">buffer_radius =</span> <span class="dv">20</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6"></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co"># assign crs</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8">sf<span class="op">::</span><span class="kw">st_crs</span>(patch_sf_data) &lt;-<span class="st"> </span><span class="dv">32631</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co"># get summary data</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11">patch_summary_data &lt;-<span class="st"> </span><span class="kw">atl_patch_summary</span>(patch_res_known,</a>
<a class="sourceLine" id="cb17-12" data-line-number="12">  <span class="dt">which_data =</span> <span class="st">&quot;summary&quot;</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13">)</a></code></pre></div>
<p>At this stage, users have successfully pre-processed their data from raw positions to residence patches.
Residence patches are essentially <code>sf</code> objects and can be visualised using the <code>sf</code> method for <code>plot</code>; for instance <code>plot(patch_sf_data)</code>.
Further sections reproduce the analyses in the main manuscript.</p>
<hr />
</div>
<div id="prepare-to-plot-data" class="section level3">
<h3><span class="header-section-number">1.9.6</span> Prepare to plot data</h3>
<p>We read in the island’s shapefile to plot it as a background for the residence patch figure.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># read griend and hut</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">griend &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">st_read</span>(<span class="st">&quot;data/griend_polygon/griend_polygon.shp&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">hut &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw">st_read</span>(<span class="st">&quot;data/griend_hut.gpkg&quot;</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="figures/fig_calib_residence.png" alt="Classifying thinned data into residence patches yields robust estimates of the duration of known stops. The island of Griend (53.25^{\circ}N, 5.25^{\circ}E) is shown in beige. Residence patches (green polygons; function parameters in text) correspond well to the locations of known stops (purple triangles). However, the algorithm identified all areas with prolonged residence, including those which were not intended stops (n = 12; green polygons without triangles). The field station on Griend (red triangle) was not intended to be a stop, but the tags were stored here before the trial, and the method correctly picked up this prolonged stationary data as a residence patch. The algorithm failed to find two stops of 6 and 15 seconds duration, since these were lost in the data thinning step (purple triangle without green polygon shows one of these). The area shown is the lower rectangle in Fig. 1.3." />
<p class="caption">Classifying thinned data into residence patches yields robust estimates of the duration of known stops. The island of Griend (53.25<span class="math inline">\(^{\circ}\)</span>N, 5.25<span class="math inline">\(^{\circ}\)</span>E) is shown in beige. Residence patches (green polygons; function parameters in text) correspond well to the locations of known stops (purple triangles). However, the algorithm identified all areas with prolonged residence, including those which were not intended stops (n = 12; green polygons without triangles). The field station on Griend (red triangle) was not intended to be a stop, but the tags were stored here before the trial, and the method correctly picked up this prolonged stationary data as a residence patch. The algorithm failed to find two stops of 6 and 15 seconds duration, since these were lost in the data thinning step (purple triangle without green polygon shows one of these). The area shown is the lower rectangle in Fig. 1.3.</p>
</div>
</div>
</div>
<div id="compare-patch-metrics" class="section level2">
<h2><span class="header-section-number">1.10</span> Compare patch metrics</h2>
<p>We filter these data to exclude one exceedingly long outlier of about an hour (WP080).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># round median coordinate for inferred patches</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">patch_summary_inferred &lt;-</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="st">  </span>patch_summary_data[</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">    ,</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">      <span class="st">&quot;x_median&quot;</span>, <span class="st">&quot;y_median&quot;</span>,</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">      <span class="st">&quot;nfixes&quot;</span>, <span class="st">&quot;duration&quot;</span>, <span class="st">&quot;patch&quot;</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    )</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">  ][, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">    <span class="dt">x_median =</span> <span class="kw">round</span>(x_median, <span class="dt">digits =</span> <span class="dv">-2</span>),</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">    <span class="dt">y_median =</span> <span class="kw">round</span>(y_median, <span class="dt">digits =</span> <span class="dv">-2</span>)</a>
<a class="sourceLine" id="cb19-12" data-line-number="12">  )]</a></code></pre></div>
<p>We add data from the known patches, matching by X and Y median.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># join with respatch summary</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">patch_summary_compare &lt;-</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw">merge</span>(patch_summary_real,</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">    patch_summary_inferred,</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">    <span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;x_median&quot;</span>, <span class="st">&quot;y_median&quot;</span>),</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">    <span class="dt">all.x =</span> <span class="ot">TRUE</span>, <span class="dt">all.y =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb20-8" data-line-number="8"></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co"># drop nas</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10">patch_summary_compare &lt;-<span class="st"> </span><span class="kw">na.omit</span>(patch_summary_compare)</a>
<a class="sourceLine" id="cb20-11" data-line-number="11"></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co"># drop patch around WP080</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13">patch_summary_compare &lt;-<span class="st"> </span>patch_summary_compare[tID <span class="op">!=</span><span class="st"> &quot;WP080&quot;</span>, ]</a></code></pre></div>
<p>7 patches are identified where there are no waypoints, while 2 waypoints are not identified as patches. These waypoints consisted of 6 and 15 (WP098 and WP092) positions respectively, and were lost when the data were aggregated to 30 second intervals.</p>
<div id="linear-model-durations" class="section level3">
<h3><span class="header-section-number">1.10.1</span> Linear model durations</h3>
<p>We run a simple linear model.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># get linear model</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">model_duration &lt;-<span class="st"> </span><span class="kw">lm</span>(duration_real <span class="op">~</span><span class="st"> </span>duration,</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  <span class="dt">data =</span> patch_summary_compare</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="co"># get R2</span></a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="kw">summary</span>(model_duration)</a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">#&gt; lm(formula = duration_real ~ duration, data = patch_summary_compare)</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="co">#&gt; -105.07  -16.51   -4.26    9.54   91.66 </span></a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-16" data-line-number="16"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb21-18" data-line-number="18"><span class="co">#&gt; (Intercept) 102.4395    47.4097    2.16    0.046 *  </span></a>
<a class="sourceLine" id="cb21-19" data-line-number="19"><span class="co">#&gt; duration      1.0225     0.0786   13.02  6.3e-10 ***</span></a>
<a class="sourceLine" id="cb21-20" data-line-number="20"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb21-21" data-line-number="21"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb21-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb21-23" data-line-number="23"><span class="co">#&gt; Residual standard error: 50.2 on 16 degrees of freedom</span></a>
<a class="sourceLine" id="cb21-24" data-line-number="24"><span class="co">#&gt; Multiple R-squared:  0.914,  Adjusted R-squared:  0.908 </span></a>
<a class="sourceLine" id="cb21-25" data-line-number="25"><span class="co">#&gt; F-statistic:  169 on 1 and 16 DF,  p-value: 6.29e-10</span></a>
<a class="sourceLine" id="cb21-26" data-line-number="26"></a>
<a class="sourceLine" id="cb21-27" data-line-number="27"><span class="co"># write to file</span></a>
<a class="sourceLine" id="cb21-28" data-line-number="28"><span class="kw">writeLines</span>(</a>
<a class="sourceLine" id="cb21-29" data-line-number="29">  <span class="dt">text =</span> <span class="kw">capture.output</span>(</a>
<a class="sourceLine" id="cb21-30" data-line-number="30">    <span class="kw">summary</span>(model_duration)</a>
<a class="sourceLine" id="cb21-31" data-line-number="31">  ),</a>
<a class="sourceLine" id="cb21-32" data-line-number="32">  <span class="dt">con =</span> <span class="st">&quot;data/model_output_residence_patch.txt&quot;</span></a>
<a class="sourceLine" id="cb21-33" data-line-number="33">)</a></code></pre></div>
<div class="figure">
<img src="figures/fig_calib_lm_duration.png" alt="The inferred duration of residence patches corresponds very closely to the real duration (grey circles, red line shows linear model fit), with an underestimation of the true duration of around 2%. The dashed black line represents y = x for reference." />
<p class="caption">The inferred duration of residence patches corresponds very closely to the real duration (grey circles, red line shows linear model fit), with an underestimation of the true duration of around 2%. The dashed black line represents <span class="math inline">\(y = x\)</span> for reference.</p>
</div>
</div>
<div id="linear-model-summary" class="section level3">
<h3><span class="header-section-number">1.10.2</span> Linear model summary</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">cat</span>(</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">  <span class="kw">readLines</span>(</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">    <span class="dt">con =</span> <span class="st">&quot;data/model_output_residence_patch.txt&quot;</span>,</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">    <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5">  ),</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">  <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co">#&gt; lm(formula = duration_real ~ duration, data = patch_summary_compare)</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="co">#&gt; -105.07  -16.51   -4.26    9.54   91.66 </span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-16" data-line-number="16"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb22-17" data-line-number="17"><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb22-18" data-line-number="18"><span class="co">#&gt; (Intercept) 102.4395    47.4097    2.16    0.046 *  </span></a>
<a class="sourceLine" id="cb22-19" data-line-number="19"><span class="co">#&gt; duration      1.0225     0.0786   13.02  6.3e-10 ***</span></a>
<a class="sourceLine" id="cb22-20" data-line-number="20"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb22-21" data-line-number="21"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb22-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-23" data-line-number="23"><span class="co">#&gt; Residual standard error: 50.2 on 16 degrees of freedom</span></a>
<a class="sourceLine" id="cb22-24" data-line-number="24"><span class="co">#&gt; Multiple R-squared:  0.914,  Adjusted R-squared:  0.908 </span></a>
<a class="sourceLine" id="cb22-25" data-line-number="25"><span class="co">#&gt; F-statistic:  169 on 1 and 16 DF,  p-value: 6.29e-10</span></a></code></pre></div>
</div>
</div>
<div id="main-text-figure-7" class="section level2">
<h2><span class="header-section-number">1.11</span> Main text Figure 7</h2>
<p>See main text for Figure 7. Plotting code is not shown in PDF and HTML form, see the <code>.Rmd</code> file.</p>

</div>
</div>
<h3> References</h3>
<div id="refs" class="references">
<div id="ref-barraquand2008">
<p>Barraquand, Frédéric, and Simon Benhamou. 2008. “Animal Movements in Heterogeneous Landscapes: Identifying Profitable Places and Homogeneous Movement Bouts.” <em>Ecology</em> 89 (12): 3336–48. <a href="https://doi.org/10.1890/08-0162.1" class="uri">https://doi.org/10.1890/08-0162.1</a>.</p>
</div>
<div id="ref-beardsworth2021">
<p>Beardsworth, Christine E., Evy Gobbens, Frank van Maarseveen, Bas Denissen, Anne Dekinga, Ran Nathan, Sivan Toledo, and Allert I. Bijleveld. 2021. “Validating a High-Throughput Tracking System: ATLAS as a Regional-Scale Alternative to GPS.” <em>bioRxiv</em>, February. Cold Spring Harbor Laboratory, 2021.02.09.430514. <a href="https://doi.org/10.1101/2021.02.09.430514" class="uri">https://doi.org/10.1101/2021.02.09.430514</a>.</p>
</div>
<div id="ref-bijleveld2016">
<p>Bijleveld, Allert Imre, Robert B MacCurdy, Ying-Chi Chan, Emma Penning, Richard M. Gabrielson, John Cluderay, Erik L. Spaulding, et al. 2016. “Understanding Spatial Distributions: Negative Density-Dependence in Prey Causes Predators to Trade-Off Prey Quantity with Quality.” <em>Proceedings of the Royal Society B: Biological Sciences</em> 283 (1828): 20151557. <a href="https://doi.org/10.1098/rspb.2015.1557" class="uri">https://doi.org/10.1098/rspb.2015.1557</a>.</p>
</div>
<div id="ref-dowle2020">
<p>Dowle, Matt, and Arun Srinivasan. 2020. <em>Data.Table: Extension of ‘data.Frame‘</em>. Manual.</p>
</div>
<div id="ref-gupte2020a">
<p>Gupte, Pratik Rajan. 2020. “Atlastools: Pre-Processing Tools for High Frequency Tracking Data.” Zenodo. <a href="https://doi.org/10.5281/ZENODO.4033154" class="uri">https://doi.org/10.5281/ZENODO.4033154</a>.</p>
</div>
<div id="ref-oudman2018">
<p>Oudman, Thomas, Theunis Piersma, Mohamed V. Ahmedou Salem, Marieke E. Feis, Anne Dekinga, Sander Holthuijsen, Job ten Horn, Jan A. van Gils, and Allert I. Bijleveld. 2018. “Resource Landscapes Explain Contrasting Patterns of Aggregation and Site Fidelity by Red Knots at Two Wintering Sites.” <em>Movement Ecology</em> 6 (1): 24–24. <a href="https://doi.org/10.1186/s40462-018-0142-4" class="uri">https://doi.org/10.1186/s40462-018-0142-4</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="processing-egyptian-fruit-bat-tracks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["supplementary_material.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
