<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 5 Processing calibration data | Pre-processing high frequency animal tracking data</title>
  <meta name="description" content="TRES Tidyverse Tutorial" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 5 Processing calibration data | Pre-processing high frequency animal tracking data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="TRES Tidyverse Tutorial" />
  <meta name="github-repo" content="pratikunterwegs/atlas-best-practices" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 5 Processing calibration data | Pre-processing high frequency animal tracking data" />
  
  <meta name="twitter:description" content="TRES Tidyverse Tutorial" />
  

<meta name="author" content="Pratik R. Gupte and others" />


<meta name="date" content="2020-10-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="residence-patches-and-their-construction.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a><ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#installing-atlastools"><i class="fa fa-check"></i><b>1.1</b> Installing <code>atlastools</code></a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#simulating-movement-data"><i class="fa fa-check"></i><b>1.2</b> Simulating movement data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reducing-large-scale-positioning-error-by-filtering.html"><a href="reducing-large-scale-positioning-error-by-filtering.html"><i class="fa fa-check"></i><b>2</b> Reducing Large-Scale Positioning Error by Filtering</a><ul>
<li class="chapter" data-level="2.1" data-path="reducing-large-scale-positioning-error-by-filtering.html"><a href="reducing-large-scale-positioning-error-by-filtering.html#prepare-libraries"><i class="fa fa-check"></i><b>2.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="2.2" data-path="reducing-large-scale-positioning-error-by-filtering.html"><a href="reducing-large-scale-positioning-error-by-filtering.html#introducing-errors-to-the-data"><i class="fa fa-check"></i><b>2.2</b> Introducing Errors to the Data</a><ul>
<li class="chapter" data-level="" data-path="reducing-large-scale-positioning-error-by-filtering.html"><a href="reducing-large-scale-positioning-error-by-filtering.html#make-figure-of-simulated-data"><i class="fa fa-check"></i>Make Figure of Simulated Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="reducing-large-scale-positioning-error-by-filtering.html"><a href="reducing-large-scale-positioning-error-by-filtering.html#filtering-by-spatial-bounds"><i class="fa fa-check"></i><b>2.3</b> Filtering by spatial bounds</a></li>
<li class="chapter" data-level="2.4" data-path="reducing-large-scale-positioning-error-by-filtering.html"><a href="reducing-large-scale-positioning-error-by-filtering.html#removing-point-outliers-the-non-movement-approach"><i class="fa fa-check"></i><b>2.4</b> Removing point outliers: The non-movement approach</a></li>
<li class="chapter" data-level="2.5" data-path="reducing-large-scale-positioning-error-by-filtering.html"><a href="reducing-large-scale-positioning-error-by-filtering.html#reflections-challenges-to-the-non-movement-approach"><i class="fa fa-check"></i><b>2.5</b> Reflections: Challenges to the non-movement approach</a></li>
<li class="chapter" data-level="2.6" data-path="reducing-large-scale-positioning-error-by-filtering.html"><a href="reducing-large-scale-positioning-error-by-filtering.html#export-data"><i class="fa fa-check"></i><b>2.6</b> Export data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html"><i class="fa fa-check"></i><b>3</b> Smoothing tracks and aggregating dat</a><ul>
<li class="chapter" data-level="" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html#prepare-libraries-1"><i class="fa fa-check"></i>Prepare libraries</a></li>
<li class="chapter" data-level="" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html#reading-in-data"><i class="fa fa-check"></i>Reading in data</a></li>
<li class="chapter" data-level="3.1" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html#applying-a-median-smooth"><i class="fa fa-check"></i><b>3.1</b> Applying a median smooth</a><ul>
<li class="chapter" data-level="3.1.1" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html#robustness-to-large-gaps"><i class="fa fa-check"></i><b>3.1.1</b> Robustness to large gaps</a></li>
<li class="chapter" data-level="3.1.2" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html#plot-results"><i class="fa fa-check"></i><b>3.1.2</b> Plot results</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html#aggregating-data"><i class="fa fa-check"></i><b>3.2</b> Aggregating data</a><ul>
<li class="chapter" data-level="3.2.1" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html#aggregation-before-correction-a-warning"><i class="fa fa-check"></i><b>3.2.1</b> Aggregation before correction, a warning</a></li>
<li class="chapter" data-level="3.2.2" data-path="smoothing-tracks-and-aggregating-dat.html"><a href="smoothing-tracks-and-aggregating-dat.html#combine-with-aggregations"><i class="fa fa-check"></i><b>3.2.2</b> Combine with aggregations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html"><i class="fa fa-check"></i><b>4</b> Residence patches and their construction</a><ul>
<li class="chapter" data-level="" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html#prepare-libraries-2"><i class="fa fa-check"></i>Prepare libraries</a></li>
<li class="chapter" data-level="4.1" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html#an-example-with-simulated-data"><i class="fa fa-check"></i><b>4.1</b> An example with simulated data</a><ul>
<li class="chapter" data-level="4.1.1" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html#read-data-and-classify"><i class="fa fa-check"></i><b>4.1.1</b> Read data and classify</a></li>
<li class="chapter" data-level="4.1.2" data-path="residence-patches-and-their-construction.html"><a href="residence-patches-and-their-construction.html#plot-classified-residence-patches"><i class="fa fa-check"></i><b>4.1.2</b> Plot classified residence patches</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html"><i class="fa fa-check"></i><b>5</b> Processing calibration data</a><ul>
<li class="chapter" data-level="5.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#prepare-libraries-3"><i class="fa fa-check"></i><b>5.1</b> Prepare libraries</a></li>
<li class="chapter" data-level="5.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#preliminary-visualisation"><i class="fa fa-check"></i><b>5.2</b> Preliminary visualisation</a></li>
<li class="chapter" data-level="5.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#filter-by-bounding-box"><i class="fa fa-check"></i><b>5.3</b> Filter by bounding box</a><ul>
<li class="chapter" data-level="5.3.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#remove-low-base-station-positions"><i class="fa fa-check"></i><b>5.3.1</b> Remove low base station positions</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#filter-trajectories"><i class="fa fa-check"></i><b>5.4</b> Filter trajectories</a><ul>
<li class="chapter" data-level="5.4.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#handle-time"><i class="fa fa-check"></i><b>5.4.1</b> Handle time</a></li>
<li class="chapter" data-level="5.4.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#add-speed-and-turning-angle"><i class="fa fa-check"></i><b>5.4.2</b> Add speed and turning angle</a></li>
<li class="chapter" data-level="5.4.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#get-95th-percentile-of-speed-and-angle"><i class="fa fa-check"></i><b>5.4.3</b> Get 95th percentile of speed and angle</a></li>
<li class="chapter" data-level="5.4.4" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-to-see-speeds"><i class="fa fa-check"></i><b>5.4.4</b> Plot to see speeds</a></li>
<li class="chapter" data-level="5.4.5" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#filter-on-speed"><i class="fa fa-check"></i><b>5.4.5</b> Filter on speed</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#smoothing-the-trajectory"><i class="fa fa-check"></i><b>5.5</b> Smoothing the trajectory</a><ul>
<li class="chapter" data-level="5.5.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-pre-processing-steps"><i class="fa fa-check"></i><b>5.5.1</b> Plot pre-processing steps</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#making-residence-patches"><i class="fa fa-check"></i><b>5.6</b> Making residence patches</a><ul>
<li class="chapter" data-level="5.6.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#prepare-data"><i class="fa fa-check"></i><b>5.6.1</b> Prepare data</a></li>
<li class="chapter" data-level="5.6.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#calculate-residence-time"><i class="fa fa-check"></i><b>5.6.2</b> Calculate residence time</a></li>
<li class="chapter" data-level="5.6.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#run-residence-patch-method"><i class="fa fa-check"></i><b>5.6.3</b> Run residence patch method</a></li>
<li class="chapter" data-level="5.6.4" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#get-spatial-and-summary-objects"><i class="fa fa-check"></i><b>5.6.4</b> Get spatial and summary objects</a></li>
<li class="chapter" data-level="5.6.5" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-the-outcome"><i class="fa fa-check"></i><b>5.6.5</b> Plot the outcome</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#compare-patch-metrics"><i class="fa fa-check"></i><b>5.7</b> Compare patch metrics</a><ul>
<li class="chapter" data-level="5.7.1" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#compare-known-patches"><i class="fa fa-check"></i><b>5.7.1</b> Compare known patches</a></li>
<li class="chapter" data-level="5.7.2" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#plot-durations-comparisons"><i class="fa fa-check"></i><b>5.7.2</b> Plot durations comparisons</a></li>
<li class="chapter" data-level="5.7.3" data-path="processing-calibration-data.html"><a href="processing-calibration-data.html#join-patch-map-and-duration-comparison-figure"><i class="fa fa-check"></i><b>5.7.3</b> Join patch map and duration comparison figure</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Pre-processing high frequency animal tracking data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="processing-calibration-data" class="section level1">
<h1><span class="header-section-number">Section 5</span> Processing calibration data</h1>
<div id="prepare-libraries-3" class="section level2">
<h2><span class="header-section-number">5.1</span> Prepare libraries</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="co"># load libs</span></a>
<a class="sourceLine" id="cb33-2" title="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb33-3" title="3"><span class="kw">library</span>(atlastools)</a>
<a class="sourceLine" id="cb33-4" title="4"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb33-5" title="5"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb33-6" title="6"></a>
<a class="sourceLine" id="cb33-7" title="7"><span class="co"># prepare a palette</span></a>
<a class="sourceLine" id="cb33-8" title="8">pal &lt;-<span class="st"> </span>RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">4</span>, <span class="st">&quot;Set1&quot;</span>)</a></code></pre></div>
</div>
<div id="preliminary-visualisation" class="section level2">
<h2><span class="header-section-number">5.2</span> Preliminary visualisation</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="co"># read and plot example data</span></a>
<a class="sourceLine" id="cb34-2" title="2">data &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">&quot;data/atlas1060_allTrials_annotated.csv&quot;</span>)</a>
<a class="sourceLine" id="cb34-3" title="3">data_raw &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb34-4" title="4"></a>
<a class="sourceLine" id="cb34-5" title="5"><span class="co"># plot data</span></a>
<a class="sourceLine" id="cb34-6" title="6">fig_data_raw &lt;-</a>
<a class="sourceLine" id="cb34-7" title="7"><span class="st">  </span><span class="kw">ggplot</span>(data)<span class="op">+</span></a>
<a class="sourceLine" id="cb34-8" title="8"><span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb34-9" title="9">             <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb34-10" title="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb34-11" title="11">             <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="dv">2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb34-12" title="12"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb34-13" title="13"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">32631</span>)</a>
<a class="sourceLine" id="cb34-14" title="14"></a>
<a class="sourceLine" id="cb34-15" title="15"><span class="co"># save figure</span></a>
<a class="sourceLine" id="cb34-16" title="16"><span class="kw">ggsave</span>(fig_data_raw, <span class="dt">filename =</span> <span class="st">&quot;figures/fig_calibration_raw.png&quot;</span>,</a>
<a class="sourceLine" id="cb34-17" title="17">       <span class="dt">width =</span> <span class="dv">185</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span>)</a></code></pre></div>
</div>
<div id="filter-by-bounding-box" class="section level2">
<h2><span class="header-section-number">5.3</span> Filter by bounding box</h2>
<p>Save an unprocessed copy.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a></code></pre></div>
<p>Filter by a bounding box.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="co"># remove inside must be set to falses</span></a>
<a class="sourceLine" id="cb36-2" title="2">data &lt;-<span class="st"> </span><span class="kw">atl_filter_bounds</span>(<span class="dt">data =</span> data, </a>
<a class="sourceLine" id="cb36-3" title="3">                          <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>, </a>
<a class="sourceLine" id="cb36-4" title="4">                          <span class="dt">x_range =</span> <span class="kw">c</span>(<span class="dv">645000</span>, <span class="kw">max</span>(data<span class="op">$</span>x)), </a>
<a class="sourceLine" id="cb36-5" title="5">                          <span class="dt">remove_inside =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Plot the result.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co"># plot data</span></a>
<a class="sourceLine" id="cb37-2" title="2">fig_data_bbox &lt;-</a>
<a class="sourceLine" id="cb37-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb37-4" title="4"><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> data_raw,</a>
<a class="sourceLine" id="cb37-5" title="5">            <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb37-6" title="6">             <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb37-7" title="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> data_raw,</a>
<a class="sourceLine" id="cb37-8" title="8">             <span class="kw">aes</span>(x, y,</a>
<a class="sourceLine" id="cb37-9" title="9">                 <span class="dt">col =</span> x <span class="op">&gt;</span><span class="st"> </span><span class="dv">645000</span>),</a>
<a class="sourceLine" id="cb37-10" title="10">             <span class="dt">alpha =</span> <span class="kw">ifelse</span>(data_raw<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">645000</span>, <span class="fl">0.5</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb37-11" title="11">             <span class="dt">size =</span> <span class="kw">ifelse</span>(data_raw<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">645000</span>, <span class="fl">0.3</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb37-12" title="12">             <span class="dt">show.legend =</span> F)<span class="op">+</span></a>
<a class="sourceLine" id="cb37-13" title="13"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb37-14" title="14"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">645000</span>,</a>
<a class="sourceLine" id="cb37-15" title="15">             <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb37-16" title="16"><span class="st">  </span>ggspatial<span class="op">::</span><span class="kw">annotation_scale</span>(<span class="dt">location =</span> <span class="st">&quot;br&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb37-17" title="17"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb37-18" title="18"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">32631</span>)</a>
<a class="sourceLine" id="cb37-19" title="19"></a>
<a class="sourceLine" id="cb37-20" title="20"><span class="co"># save result</span></a>
<a class="sourceLine" id="cb37-21" title="21"><span class="kw">ggsave</span>(fig_data_bbox, <span class="dt">filename =</span> <span class="st">&quot;figures/fig_calib_bbox.png&quot;</span>,</a>
<a class="sourceLine" id="cb37-22" title="22">       <span class="dt">width =</span> <span class="dv">185</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span>)</a></code></pre></div>
<div id="remove-low-base-station-positions" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Remove low base station positions</h3>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="co"># save a copy</span></a>
<a class="sourceLine" id="cb38-2" title="2">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb38-3" title="3"></a>
<a class="sourceLine" id="cb38-4" title="4"><span class="co"># remove NBS &lt;= 3</span></a>
<a class="sourceLine" id="cb38-5" title="5">data &lt;-<span class="st"> </span><span class="kw">atl_filter_covariates</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb38-6" title="6">                              <span class="dt">filters =</span> <span class="st">&quot;NBS &gt; 3&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">fig_low_nbs &lt;-</a>
<a class="sourceLine" id="cb39-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb39-3" title="3"><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb39-4" title="4">            <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb39-5" title="5">             <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb39-6" title="6"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> data_unproc,</a>
<a class="sourceLine" id="cb39-7" title="7">            <span class="kw">aes</span>(x, y,</a>
<a class="sourceLine" id="cb39-8" title="8">                <span class="dt">col =</span> <span class="kw">as.factor</span>(NBS <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb39-9" title="9">            <span class="dt">shape =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb39-10" title="10">            <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="fl">0.3</span>, <span class="dt">show.legend =</span> F)<span class="op">+</span></a>
<a class="sourceLine" id="cb39-11" title="11"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb39-12" title="12"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb39-13" title="13"><span class="st">  </span>ggspatial<span class="op">::</span><span class="kw">annotation_scale</span>(<span class="dt">location =</span> <span class="st">&quot;tl&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb39-14" title="14"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">32631</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb39-15" title="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;NBS&quot;</span>)</a>
<a class="sourceLine" id="cb39-16" title="16"></a>
<a class="sourceLine" id="cb39-17" title="17"><span class="co"># save figure</span></a>
<a class="sourceLine" id="cb39-18" title="18"><span class="kw">ggsave</span>(fig_low_nbs, <span class="dt">filename =</span> <span class="st">&quot;figures/fig_low_nbs.png&quot;</span>,</a>
<a class="sourceLine" id="cb39-19" title="19">       <span class="dt">width =</span> <span class="dv">185</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span>, <span class="dt">height =</span> <span class="dv">185</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span>)</a></code></pre></div>
</div>
</div>
<div id="filter-trajectories" class="section level2">
<h2><span class="header-section-number">5.4</span> Filter trajectories</h2>
<div id="handle-time" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Handle time</h3>
<p>Time in ATLAS tracking is counted in milliseconds and is represented by a 64-bit integer (type <code>long</code>), which is not natively supported in R; it will instead be converted to a <code>numeric</code>, or <code>double</code>.</p>
<p>This is not what is intended, but it works. The <code>bit64</code> package can help handle 64-bit integers if you want to keep to intended type.</p>
<p>A further issue is that 64-bit integers (whether represented as <code>bit64</code> or <code>double</code>) do not yield meaninful results when you try to convert them to a date-time object, such as of the class <code>POSIXct</code>.</p>
<p>This is because <code>as.POSIXct</code> fails when trying to work with 64-bit integers (it cannot interpret this type), and returns a date many thousands of years in the future (approx. 52,000 CE) if the time column is converted to <code>numeric</code>.</p>
<p>There are two possible solutions. The parsimonious one is to convert the 64-bit number to a 32-bit short integer (dividing by 1000), or to use the <code>nanotime</code> package.</p>
<p>The conversion method loses an imperceptible amount of precision. The <code>nanotime</code> requires installing another package. The first method is shown here.</p>
<p>In the spirit of not destroying data, we create a second lower-case column called <code>time</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="co"># divide by 1000, convert to integer, then convert to POSIXct</span></a>
<a class="sourceLine" id="cb40-2" title="2">data[, time <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.POSIXct</span>(<span class="kw">as.integer</span>(TIME <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>), </a>
<a class="sourceLine" id="cb40-3" title="3">                          <span class="dt">origin =</span> <span class="st">&quot;1970-01-01&quot;</span>)]</a></code></pre></div>
</div>
<div id="add-speed-and-turning-angle" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Add speed and turning angle</h3>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="co"># add incoming and outgoing speed</span></a>
<a class="sourceLine" id="cb41-2" title="2">data[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span> (<span class="dt">speed_in =</span> <span class="kw">atl_get_speed</span>(data, </a>
<a class="sourceLine" id="cb41-3" title="3">                                      <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, </a>
<a class="sourceLine" id="cb41-4" title="4">                                      <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>, </a>
<a class="sourceLine" id="cb41-5" title="5">                                      <span class="dt">time =</span> <span class="st">&quot;time&quot;</span>),</a>
<a class="sourceLine" id="cb41-6" title="6">             <span class="dt">speed_out =</span> <span class="kw">atl_get_speed</span>(data, <span class="dt">type =</span> <span class="st">&quot;out&quot;</span>))]</a>
<a class="sourceLine" id="cb41-7" title="7"></a>
<a class="sourceLine" id="cb41-8" title="8"><span class="co"># add turning angle</span></a>
<a class="sourceLine" id="cb41-9" title="9">data[, angle <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">atl_turning_angle</span>(<span class="dt">data =</span> data)]</a></code></pre></div>
</div>
<div id="get-95th-percentile-of-speed-and-angle" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Get 95th percentile of speed and angle</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="co"># use sapply</span></a>
<a class="sourceLine" id="cb42-2" title="2">speed_angle_thresholds &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb42-3" title="3"><span class="st">  </span><span class="kw">sapply</span>(data[, <span class="kw">list</span>(speed_in, speed_out, angle)], </a>
<a class="sourceLine" id="cb42-4" title="4">       quantile, <span class="dt">probs =</span> <span class="fl">0.9</span>, <span class="dt">na.rm =</span> T)</a></code></pre></div>
</div>
<div id="plot-to-see-speeds" class="section level3">
<h3><span class="header-section-number">5.4.4</span> Plot to see speeds</h3>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="co"># plot filtered data</span></a>
<a class="sourceLine" id="cb43-2" title="2">fig_speed_outliers &lt;-</a>
<a class="sourceLine" id="cb43-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb43-4" title="4"><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb43-5" title="5">            <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb43-6" title="6">             <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb43-7" title="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb43-8" title="8">             <span class="kw">aes</span>(x, y, </a>
<a class="sourceLine" id="cb43-9" title="9">                 <span class="dt">col =</span> speed_in <span class="op">&lt;</span><span class="st"> </span><span class="fl">15.7</span>),</a>
<a class="sourceLine" id="cb43-10" title="10">             <span class="dt">size =</span> <span class="fl">0.3</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb43-11" title="11">             <span class="dt">show.legend =</span> F)<span class="op">+</span></a>
<a class="sourceLine" id="cb43-12" title="12"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb43-13" title="13"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb43-14" title="14"><span class="st">  </span>ggspatial<span class="op">::</span><span class="kw">annotation_scale</span>(<span class="dt">location =</span> <span class="st">&quot;tl&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb43-15" title="15"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">32631</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb43-16" title="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;speed (m/s)&quot;</span>)</a>
<a class="sourceLine" id="cb43-17" title="17"></a>
<a class="sourceLine" id="cb43-18" title="18"><span class="co"># save</span></a>
<a class="sourceLine" id="cb43-19" title="19"><span class="kw">ggsave</span>(fig_speed_outliers, <span class="dt">filename =</span> <span class="st">&quot;figures/fig_speed_outlier.png&quot;</span>,</a>
<a class="sourceLine" id="cb43-20" title="20">       <span class="dt">width =</span> <span class="dv">185</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span>, <span class="dt">height =</span> <span class="dv">185</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span>)</a></code></pre></div>
</div>
<div id="filter-on-speed" class="section level3">
<h3><span class="header-section-number">5.4.5</span> Filter on speed</h3>
<p>Here we use a speed threshold of 20 m/s, 4 m/s lower than the 95th percentile.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="co"># make a copy</span></a>
<a class="sourceLine" id="cb44-2" title="2">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb44-3" title="3"></a>
<a class="sourceLine" id="cb44-4" title="4"><span class="co"># remove speed outliers</span></a>
<a class="sourceLine" id="cb44-5" title="5">data &lt;-<span class="st"> </span><span class="kw">atl_filter_covariates</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb44-6" title="6">            <span class="dt">filters =</span> <span class="kw">c</span>(<span class="st">&quot;(speed_in &lt; 15.7 &amp; speed_out &lt; 15.7)&quot;</span>))</a>
<a class="sourceLine" id="cb44-7" title="7"></a>
<a class="sourceLine" id="cb44-8" title="8"><span class="co"># recalculate speed and angle</span></a>
<a class="sourceLine" id="cb44-9" title="9">data[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span> (<span class="dt">speed_in =</span> <span class="kw">atl_get_speed</span>(data, </a>
<a class="sourceLine" id="cb44-10" title="10">                                      <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, </a>
<a class="sourceLine" id="cb44-11" title="11">                                      <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>, </a>
<a class="sourceLine" id="cb44-12" title="12">                                      <span class="dt">time =</span> <span class="st">&quot;time&quot;</span>),</a>
<a class="sourceLine" id="cb44-13" title="13">             <span class="dt">speed_out =</span> <span class="kw">atl_get_speed</span>(data, <span class="dt">type =</span> <span class="st">&quot;out&quot;</span>))]</a>
<a class="sourceLine" id="cb44-14" title="14"></a>
<a class="sourceLine" id="cb44-15" title="15"><span class="co"># add turning angle</span></a>
<a class="sourceLine" id="cb44-16" title="16">data[, angle <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">atl_turning_angle</span>(<span class="dt">data =</span> data)]</a></code></pre></div>
</div>
</div>
<div id="smoothing-the-trajectory" class="section level2">
<h2><span class="header-section-number">5.5</span> Smoothing the trajectory</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="co"># apply a 5 point median smooth, first make a copy</span></a>
<a class="sourceLine" id="cb45-2" title="2">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb45-3" title="3"></a>
<a class="sourceLine" id="cb45-4" title="4"><span class="co"># now apply the smooth</span></a>
<a class="sourceLine" id="cb45-5" title="5">data &lt;-<span class="st"> </span><span class="kw">atl_median_smooth</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb45-6" title="6">                          <span class="dt">x =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">time =</span> <span class="st">&quot;time&quot;</span>,</a>
<a class="sourceLine" id="cb45-7" title="7">                          <span class="dt">moving_window =</span> <span class="dv">5</span>)</a></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="co"># make figure</span></a>
<a class="sourceLine" id="cb46-2" title="2">fig_smooth &lt;-</a>
<a class="sourceLine" id="cb46-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb46-4" title="4"><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb46-5" title="5">             <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb46-6" title="6">            <span class="dt">col =</span> RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">4</span>, <span class="st">&quot;Set1&quot;</span>)[<span class="dv">4</span>])<span class="op">+</span></a>
<a class="sourceLine" id="cb46-7" title="7"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;rect&quot;</span>,</a>
<a class="sourceLine" id="cb46-8" title="8">           <span class="dt">xmin =</span> <span class="kw">c</span>(<span class="dv">650785</span>, <span class="dv">650045</span>),</a>
<a class="sourceLine" id="cb46-9" title="9">           <span class="dt">ymin =</span> <span class="kw">c</span>(<span class="dv">5904450</span>, <span class="dv">5902700</span>),</a>
<a class="sourceLine" id="cb46-10" title="10">           <span class="dt">xmax =</span> <span class="kw">c</span>(<span class="dv">652500</span>, <span class="dv">650682</span>),</a>
<a class="sourceLine" id="cb46-11" title="11">           <span class="dt">ymax =</span> <span class="kw">c</span>(<span class="dv">5906133</span>, <span class="dv">5903080</span>),</a>
<a class="sourceLine" id="cb46-12" title="12">           <span class="dt">fill =</span> <span class="st">&quot;grey90&quot;</span>,</a>
<a class="sourceLine" id="cb46-13" title="13">           <span class="dt">alpha =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb46-14" title="14">           <span class="dt">col =</span> <span class="ot">NA</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb46-15" title="15"><span class="st">    </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb46-16" title="16">           <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">650785</span>, <span class="dv">650045</span>) <span class="op">+</span><span class="st"> </span><span class="dv">400</span>,</a>
<a class="sourceLine" id="cb46-17" title="17">           <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">5904450</span>, <span class="dv">5902700</span>) <span class="op">+</span><span class="st"> </span><span class="dv">300</span>,</a>
<a class="sourceLine" id="cb46-18" title="18">           <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb46-19" title="19">           <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb46-20" title="20"><span class="st">  </span><span class="kw">theme_void</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb46-21" title="21"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">32631</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb46-22" title="22"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;track&quot;</span>)</a>
<a class="sourceLine" id="cb46-23" title="23"></a>
<a class="sourceLine" id="cb46-24" title="24"><span class="co"># make zoomed in figures</span></a>
<a class="sourceLine" id="cb46-25" title="25">fig_inset &lt;-<span class="st"> </span><span class="kw">mapply</span>(<span class="cf">function</span>(xl, yl) {</a>
<a class="sourceLine" id="cb46-26" title="26">  <span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb46-27" title="27"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> data_raw[<span class="op">!</span>data_unproc, <span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)],</a>
<a class="sourceLine" id="cb46-28" title="28">               <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb46-29" title="29">               <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>,</a>
<a class="sourceLine" id="cb46-30" title="30">               <span class="dt">shape =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb46-31" title="31">               <span class="dt">size =</span> <span class="fl">0.4</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb46-32" title="32"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">data =</span> data_unproc,</a>
<a class="sourceLine" id="cb46-33" title="33">               <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb46-34" title="34">               <span class="dt">col =</span> RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&quot;Set1&quot;</span>)[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb46-35" title="35">               <span class="dt">shape =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb46-36" title="36">               <span class="dt">alpha =</span> <span class="fl">0.5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb46-37" title="37"><span class="st">    </span><span class="kw">geom_path</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb46-38" title="38">              <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb46-39" title="39">              <span class="dt">col =</span> RColorBrewer<span class="op">::</span><span class="kw">brewer.pal</span>(<span class="dv">4</span>, <span class="st">&quot;Set1&quot;</span>)[<span class="dv">4</span>])<span class="op">+</span></a>
<a class="sourceLine" id="cb46-40" title="40"><span class="st">    </span>ggthemes<span class="op">::</span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb46-41" title="41"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb46-42" title="42">          <span class="dt">axis.text =</span> <span class="kw">element_blank</span>())<span class="op">+</span></a>
<a class="sourceLine" id="cb46-43" title="43"><span class="st">    </span>ggspatial<span class="op">::</span><span class="kw">annotation_scale</span>(<span class="dt">location =</span> <span class="st">&quot;br&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb46-44" title="44"><span class="st">    </span><span class="kw">coord_cartesian</span>(</a>
<a class="sourceLine" id="cb46-45" title="45">             <span class="dt">xlim =</span> xl,</a>
<a class="sourceLine" id="cb46-46" title="46">             <span class="dt">ylim =</span> yl, <span class="dt">expand =</span> F</a>
<a class="sourceLine" id="cb46-47" title="47">             )<span class="op">+</span></a>
<a class="sourceLine" id="cb46-48" title="48"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;track&quot;</span>)</a>
<a class="sourceLine" id="cb46-49" title="49">}, <span class="kw">list</span>(<span class="dt">xl1 =</span> <span class="kw">c</span>(<span class="dv">650785</span>, <span class="dv">652500</span>),</a>
<a class="sourceLine" id="cb46-50" title="50">        <span class="dt">xl2 =</span> <span class="kw">c</span>(<span class="dv">650045</span>, <span class="dv">650682</span>)),</a>
<a class="sourceLine" id="cb46-51" title="51">   <span class="kw">list</span>(<span class="dt">yl1 =</span> <span class="kw">c</span>(<span class="dv">5904450</span>, <span class="dv">5906133</span>),</a>
<a class="sourceLine" id="cb46-52" title="52">        <span class="dt">yl2 =</span> <span class="kw">c</span>(<span class="dv">5902700</span>, <span class="dv">5903080</span>)),</a>
<a class="sourceLine" id="cb46-53" title="53"><span class="dt">SIMPLIFY =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb46-54" title="54"></a>
<a class="sourceLine" id="cb46-55" title="55"><span class="co"># add global figure to second inset</span></a>
<a class="sourceLine" id="cb46-56" title="56">fig_inset[[<span class="dv">2</span>]] &lt;-<span class="st"> </span>fig_inset[[<span class="dv">2</span>]] <span class="op">+</span></a>
<a class="sourceLine" id="cb46-57" title="57"><span class="st">  </span><span class="kw">annotation_custom</span>(<span class="dt">grob =</span> <span class="kw">ggplotGrob</span>(fig_smooth),</a>
<a class="sourceLine" id="cb46-58" title="58">                    <span class="dt">xmin =</span> <span class="dv">649990</span>,</a>
<a class="sourceLine" id="cb46-59" title="59">                    <span class="dt">xmax =</span> <span class="dv">650045</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">650682</span> <span class="op">-</span><span class="st"> </span><span class="dv">650045</span>)<span class="op">/</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb46-60" title="60">                    <span class="dt">ymin =</span> <span class="dv">5903080</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">5903080</span> <span class="op">-</span><span class="st"> </span><span class="dv">5902700</span>)<span class="op">/</span><span class="fl">2.5</span>,</a>
<a class="sourceLine" id="cb46-61" title="61">                    <span class="dt">ymax =</span> <span class="dv">5903080</span></a>
<a class="sourceLine" id="cb46-62" title="62">                    )</a>
<a class="sourceLine" id="cb46-63" title="63">  </a>
<a class="sourceLine" id="cb46-64" title="64">fig_median_smooth &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb46-65" title="65"><span class="st">  </span><span class="kw">wrap_plots</span>(fig_inset)<span class="op">+</span></a>
<a class="sourceLine" id="cb46-66" title="66"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;a&quot;</span>,</a>
<a class="sourceLine" id="cb46-67" title="67">                  <span class="dt">tag_prefix =</span> <span class="st">&quot;(&quot;</span>,</a>
<a class="sourceLine" id="cb46-68" title="68">                  <span class="dt">tag_suffix =</span> <span class="st">&quot;)&quot;</span>)</a>
<a class="sourceLine" id="cb46-69" title="69"><span class="co"># save figure</span></a>
<a class="sourceLine" id="cb46-70" title="70"><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;figures/fig_calib_median_smooth.png&quot;</span>,</a>
<a class="sourceLine" id="cb46-71" title="71">       <span class="dt">width =</span> <span class="dv">185</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span>, <span class="dt">height =</span> <span class="dv">90</span> <span class="op">/</span><span class="st"> </span><span class="dv">25</span>)</a></code></pre></div>
<div id="plot-pre-processing-steps" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Plot pre-processing steps</h3>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1"><span class="co"># make combined walkthrough figure</span></a>
<a class="sourceLine" id="cb47-2" title="2">figure_walkthrough &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="st">  </span><span class="kw">wrap_plots</span>(</a>
<a class="sourceLine" id="cb47-4" title="4">  <span class="kw">append</span>(</a>
<a class="sourceLine" id="cb47-5" title="5">    <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb47-6" title="6">      fig_data_bbox, fig_low_nbs, fig_speed_outliers), </a>
<a class="sourceLine" id="cb47-7" title="7">    fig_inset),</a>
<a class="sourceLine" id="cb47-8" title="8"><span class="dt">design =</span> <span class="st">&quot;ABD</span><span class="ch">\n</span><span class="st">ACE&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb47-9" title="9"><span class="st">  </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;a&quot;</span>,</a>
<a class="sourceLine" id="cb47-10" title="10">                  <span class="dt">tag_prefix =</span> <span class="st">&quot;(&quot;</span>,</a>
<a class="sourceLine" id="cb47-11" title="11">                  <span class="dt">tag_suffix =</span> <span class="st">&quot;)&quot;</span>)</a>
<a class="sourceLine" id="cb47-12" title="12"></a>
<a class="sourceLine" id="cb47-13" title="13"><span class="co"># save combined figure</span></a>
<a class="sourceLine" id="cb47-14" title="14"><span class="kw">ggsave</span>(figure_walkthrough,</a>
<a class="sourceLine" id="cb47-15" title="15">       <span class="dt">filename =</span> <span class="st">&quot;figures/fig_walkthrough.png&quot;</span>,</a>
<a class="sourceLine" id="cb47-16" title="16">       <span class="dt">height =</span> <span class="dv">130</span>, <span class="dt">width =</span> <span class="dv">225</span>, <span class="dt">units =</span> <span class="st">&quot;mm&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="making-residence-patches" class="section level2">
<h2><span class="header-section-number">5.6</span> Making residence patches</h2>
<div id="prepare-data" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Prepare data</h3>
<p>An indicator of individual residence at or near a position can be useful when attempting to identify residence patches. Positions can be filtered on a metric such as residence time (see Bracis et al. 2018).</p>
<p>In this dataset, residence positions are marked in the <code>tID</code> column as beginning with <code>WP</code>. These can be extracted and converted into residence patches.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="co"># make a data copy</span></a>
<a class="sourceLine" id="cb48-2" title="2">data_unproc &lt;-<span class="st"> </span><span class="kw">copy</span>(data)</a>
<a class="sourceLine" id="cb48-3" title="3"></a>
<a class="sourceLine" id="cb48-4" title="4"><span class="co"># assign residence positions</span></a>
<a class="sourceLine" id="cb48-5" title="5">data[, residence <span class="op">:</span><span class="er">=</span><span class="st"> </span>stringi<span class="op">::</span><span class="kw">stri_detect</span>(tID, <span class="dt">regex =</span> <span class="st">&quot;WP&quot;</span>)]</a>
<a class="sourceLine" id="cb48-6" title="6"></a>
<a class="sourceLine" id="cb48-7" title="7"><span class="co"># make a copy of only residence points</span></a>
<a class="sourceLine" id="cb48-8" title="8">data_res &lt;-<span class="st"> </span>data[residence <span class="op">==</span><span class="st"> </span>T, ]</a></code></pre></div>
</div>
<div id="calculate-residence-time" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Calculate residence time</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="co"># load recurse</span></a>
<a class="sourceLine" id="cb49-2" title="2"><span class="kw">library</span>(recurse)</a>
<a class="sourceLine" id="cb49-3" title="3"></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="co"># get recurse data for a 10m radius</span></a>
<a class="sourceLine" id="cb49-5" title="5">data_recurse &lt;-<span class="st"> </span><span class="kw">getRecursions</span>(data_unproc[, <span class="kw">list</span>(x, y, time, TAG)],</a>
<a class="sourceLine" id="cb49-6" title="6">                              <span class="dt">radius =</span> <span class="dv">200</span>)</a></code></pre></div>
</div>
<div id="run-residence-patch-method" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Run residence patch method</h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="co"># on known residence points</span></a>
<a class="sourceLine" id="cb50-2" title="2">patch_res_known &lt;-<span class="st"> </span><span class="kw">atl_res_patch</span>(data_res, </a>
<a class="sourceLine" id="cb50-3" title="3">                                <span class="dt">buffer_radius =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb50-4" title="4">                                <span class="dt">lim_spat_indep =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb50-5" title="5">                                <span class="dt">lim_time_indep =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb50-6" title="6">                                <span class="dt">min_fixes =</span> <span class="dv">3</span>)</a></code></pre></div>
</div>
<div id="get-spatial-and-summary-objects" class="section level3">
<h3><span class="header-section-number">5.6.4</span> Get spatial and summary objects</h3>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1"><span class="co"># for the known and unkniwn patches</span></a>
<a class="sourceLine" id="cb51-2" title="2">patch_sf_data &lt;-<span class="st"> </span><span class="kw">atl_patch_summary</span>(patch_res_known, <span class="dt">which_data =</span> <span class="st">&quot;spatial&quot;</span>)</a>
<a class="sourceLine" id="cb51-3" title="3"></a>
<a class="sourceLine" id="cb51-4" title="4"><span class="co"># assign crs</span></a>
<a class="sourceLine" id="cb51-5" title="5">sf<span class="op">::</span><span class="kw">st_crs</span>(patch_sf_data) &lt;-<span class="st"> </span><span class="dv">32631</span></a>
<a class="sourceLine" id="cb51-6" title="6"></a>
<a class="sourceLine" id="cb51-7" title="7"><span class="co"># get summary data</span></a>
<a class="sourceLine" id="cb51-8" title="8">patch_summary_data &lt;-<span class="st"> </span><span class="kw">atl_patch_summary</span>(patch_res_known, <span class="dt">which_data =</span> <span class="st">&quot;summary&quot;</span>)</a></code></pre></div>
</div>
<div id="plot-the-outcome" class="section level3">
<h3><span class="header-section-number">5.6.5</span> Plot the outcome</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="co"># patch with residence points and all patches</span></a>
<a class="sourceLine" id="cb52-2" title="2">fig_basic_residence &lt;-</a>
<a class="sourceLine" id="cb52-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb52-4" title="4"><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> data,</a>
<a class="sourceLine" id="cb52-5" title="5">            <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb52-6" title="6">            <span class="dt">lwd =</span> <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb52-7" title="7">            <span class="dt">col =</span> <span class="st">&quot;grey20&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb52-8" title="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> data_res,</a>
<a class="sourceLine" id="cb52-9" title="9">             <span class="kw">aes</span>(x, y),</a>
<a class="sourceLine" id="cb52-10" title="10">             <span class="dt">shape =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb52-11" title="11">             <span class="dt">size =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb52-12" title="12">             <span class="dt">col =</span> pal[<span class="dv">2</span>])<span class="op">+</span></a>
<a class="sourceLine" id="cb52-13" title="13"><span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> patch_summary_data,</a>
<a class="sourceLine" id="cb52-14" title="14">            <span class="kw">aes</span>(x_median <span class="op">+</span><span class="st"> </span><span class="dv">200</span>, y_median),</a>
<a class="sourceLine" id="cb52-15" title="15">            <span class="dt">col =</span> <span class="st">&quot;orange&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb52-16" title="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> patch_summary_data,</a>
<a class="sourceLine" id="cb52-17" title="17">             <span class="kw">aes</span>(x_median <span class="op">+</span><span class="st"> </span><span class="dv">200</span>, y_median,</a>
<a class="sourceLine" id="cb52-18" title="18">                 <span class="dt">fill =</span> duration <span class="op">/</span><span class="st"> </span><span class="dv">60</span>),</a>
<a class="sourceLine" id="cb52-19" title="19">             <span class="dt">size =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb52-20" title="20">             <span class="dt">shape =</span> <span class="dv">21</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb52-21" title="21"><span class="st">  </span></a>
<a class="sourceLine" id="cb52-22" title="22"><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>,</a>
<a class="sourceLine" id="cb52-23" title="23">                       <span class="dt">direction =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb52-24" title="24">                       <span class="dt">trans =</span> <span class="st">&quot;log10&quot;</span>,</a>
<a class="sourceLine" id="cb52-25" title="25">                       <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">60</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb52-26" title="26"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb52-27" title="27"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</a>
<a class="sourceLine" id="cb52-28" title="28">        <span class="dt">legend.key.width =</span> <span class="kw">unit</span>(<span class="dv">3</span>, <span class="dt">units =</span> <span class="st">&quot;mm&quot;</span>),</a>
<a class="sourceLine" id="cb52-29" title="29">        <span class="dt">legend.background =</span> <span class="kw">element_blank</span>())<span class="op">+</span></a>
<a class="sourceLine" id="cb52-30" title="30"><span class="st">  </span>ggspatial<span class="op">::</span><span class="kw">annotation_scale</span>(<span class="dt">location =</span> <span class="st">&quot;tl&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb52-31" title="31"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">32631</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb52-32" title="32"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;inferred</span><span class="ch">\n</span><span class="st">duration (min)&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="compare-patch-metrics" class="section level2">
<h2><span class="header-section-number">5.7</span> Compare patch metrics</h2>
<div id="compare-known-patches" class="section level3">
<h3><span class="header-section-number">5.7.1</span> Compare known patches</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="co"># get known patch summary</span></a>
<a class="sourceLine" id="cb53-2" title="2">patch_summary_real &lt;-<span class="st"> </span>data_res[, <span class="kw">list</span>(<span class="dt">nfixes_real =</span> .N,</a>
<a class="sourceLine" id="cb53-3" title="3">                                      <span class="dt">x_median =</span> <span class="kw">round</span>(<span class="kw">median</span>(x), <span class="dt">digits =</span> <span class="dv">-2</span>),</a>
<a class="sourceLine" id="cb53-4" title="4">                                      <span class="dt">y_median =</span> <span class="kw">round</span>(<span class="kw">median</span>(y), <span class="dt">digits =</span> <span class="dv">-2</span>),</a>
<a class="sourceLine" id="cb53-5" title="5">                                      <span class="dt">duration_real =</span> <span class="kw">as.numeric</span>(</a>
<a class="sourceLine" id="cb53-6" title="6">                                        <span class="kw">max</span>(time) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(time))), </a>
<a class="sourceLine" id="cb53-7" title="7">                               by =<span class="st"> &quot;tID&quot;</span>]</a>
<a class="sourceLine" id="cb53-8" title="8"></a>
<a class="sourceLine" id="cb53-9" title="9"><span class="co"># round median coordinate for inferred patches</span></a>
<a class="sourceLine" id="cb53-10" title="10">patch_summary_inferred &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb53-11" title="11"><span class="st">  </span>patch_summary_data[, </a>
<a class="sourceLine" id="cb53-12" title="12">                     <span class="kw">c</span>(<span class="st">&quot;x_median&quot;</span>, <span class="st">&quot;y_median&quot;</span>, </a>
<a class="sourceLine" id="cb53-13" title="13">                       <span class="st">&quot;nfixes&quot;</span>, <span class="st">&quot;duration&quot;</span>)</a>
<a class="sourceLine" id="cb53-14" title="14">                     ][, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">x_median =</span> <span class="kw">round</span>(x_median, <span class="dt">digits =</span> <span class="dv">-2</span>),</a>
<a class="sourceLine" id="cb53-15" title="15">                              <span class="dt">y_median =</span> <span class="kw">round</span>(y_median, <span class="dt">digits =</span> <span class="dv">-2</span>))]</a>
<a class="sourceLine" id="cb53-16" title="16"></a>
<a class="sourceLine" id="cb53-17" title="17"><span class="co"># join with respatch summary</span></a>
<a class="sourceLine" id="cb53-18" title="18">patch_summary_compare &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb53-19" title="19"><span class="st">  </span><span class="kw">merge</span>(patch_summary_real,</a>
<a class="sourceLine" id="cb53-20" title="20">        patch_summary_inferred, </a>
<a class="sourceLine" id="cb53-21" title="21">        <span class="dt">on =</span> <span class="kw">c</span>(<span class="st">&quot;x_median&quot;</span>, <span class="st">&quot;y_median&quot;</span>),</a>
<a class="sourceLine" id="cb53-22" title="22">        <span class="dt">all.x =</span> <span class="ot">TRUE</span>, <span class="dt">all.y =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="plot-durations-comparisons" class="section level3">
<h3><span class="header-section-number">5.7.2</span> Plot durations comparisons</h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1"><span class="co"># get linear model</span></a>
<a class="sourceLine" id="cb54-2" title="2">model_duration &lt;-<span class="st"> </span><span class="kw">lm</span>(duration_real <span class="op">~</span><span class="st"> </span>duration,</a>
<a class="sourceLine" id="cb54-3" title="3">                     <span class="dt">data =</span> patch_summary_compare)</a>
<a class="sourceLine" id="cb54-4" title="4"></a>
<a class="sourceLine" id="cb54-5" title="5"><span class="co"># get R2</span></a>
<a class="sourceLine" id="cb54-6" title="6"><span class="kw">summary</span>(model_duration)</a></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="co"># make figure comparing different methods</span></a>
<a class="sourceLine" id="cb55-2" title="2">figure_patch_duration &lt;-</a>
<a class="sourceLine" id="cb55-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb55-4" title="4"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> patch_summary_compare,</a>
<a class="sourceLine" id="cb55-5" title="5">               <span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb55-6" title="6">                   <span class="dt">xend =</span> duration,</a>
<a class="sourceLine" id="cb55-7" title="7">                   <span class="dt">y =</span> duration_real,</a>
<a class="sourceLine" id="cb55-8" title="8">                   <span class="dt">yend =</span> duration_real),</a>
<a class="sourceLine" id="cb55-9" title="9">               <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb55-10" title="10"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> patch_summary_compare,</a>
<a class="sourceLine" id="cb55-11" title="11">               <span class="kw">aes</span>(<span class="dt">x =</span> duration,</a>
<a class="sourceLine" id="cb55-12" title="12">                   <span class="dt">xend =</span> duration,</a>
<a class="sourceLine" id="cb55-13" title="13">                   <span class="dt">y =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb55-14" title="14">                   <span class="dt">yend =</span> duration_real),</a>
<a class="sourceLine" id="cb55-15" title="15">               <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb55-16" title="16"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> patch_summary_compare,</a>
<a class="sourceLine" id="cb55-17" title="17">             <span class="kw">aes</span>(duration, </a>
<a class="sourceLine" id="cb55-18" title="18">                 duration_real),</a>
<a class="sourceLine" id="cb55-19" title="19">             <span class="dt">show.legend =</span> F,</a>
<a class="sourceLine" id="cb55-20" title="20">            <span class="dt">size =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb55-21" title="21">            <span class="dt">stroke =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb55-22" title="22">            <span class="dt">shape =</span> <span class="dv">21</span>,</a>
<a class="sourceLine" id="cb55-23" title="23">            <span class="dt">fill =</span> pal[<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb55-24" title="24">            <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb55-25" title="25"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> patch_summary_compare,</a>
<a class="sourceLine" id="cb55-26" title="26">             <span class="kw">aes</span>(duration, </a>
<a class="sourceLine" id="cb55-27" title="27">                 duration_real),</a>
<a class="sourceLine" id="cb55-28" title="28">             <span class="dt">se =</span> F,</a>
<a class="sourceLine" id="cb55-29" title="29">             <span class="dt">size =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb55-30" title="30">             <span class="dt">col =</span> pal[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb55-31" title="31">             <span class="dt">alpha =</span> <span class="fl">0.2</span>,</a>
<a class="sourceLine" id="cb55-32" title="32">             <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</a>
<a class="sourceLine" id="cb55-33" title="33">             <span class="dt">show.legend =</span> F)<span class="op">+</span></a>
<a class="sourceLine" id="cb55-34" title="34"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">&quot;text&quot;</span>,</a>
<a class="sourceLine" id="cb55-35" title="35">           <span class="dt">x =</span> <span class="dv">300</span>, <span class="dt">y =</span> <span class="dv">900</span>,</a>
<a class="sourceLine" id="cb55-36" title="36">           <span class="dt">size =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb55-37" title="37">           <span class="dt">label =</span> <span class="st">&quot;R^2 == 0.849&quot;</span>,</a>
<a class="sourceLine" id="cb55-38" title="38">           <span class="dt">parse =</span> T)<span class="op">+</span></a>
<a class="sourceLine" id="cb55-39" title="39"><span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">300</span>, <span class="dv">600</span>, <span class="dv">900</span>),</a>
<a class="sourceLine" id="cb55-40" title="40">                <span class="dt">labels =</span> <span class="kw">as.integer</span>(<span class="kw">c</span>(<span class="dv">300</span>, <span class="dv">600</span>, <span class="dv">900</span>) <span class="op">/</span><span class="st"> </span><span class="dv">60</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb55-41" title="41"><span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">300</span>, <span class="dv">600</span>, <span class="dv">900</span>),</a>
<a class="sourceLine" id="cb55-42" title="42">                <span class="dt">labels =</span> <span class="kw">as.integer</span>(<span class="kw">c</span>(<span class="dv">300</span>, <span class="dv">600</span>, <span class="dv">900</span>) <span class="op">/</span><span class="st"> </span><span class="dv">60</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb55-43" title="43"><span class="st">  </span><span class="kw">coord_equal</span>(<span class="dt">expand =</span> F,</a>
<a class="sourceLine" id="cb55-44" title="44">              <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">1200</span>),</a>
<a class="sourceLine" id="cb55-45" title="45">              <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">1200</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb55-46" title="46"><span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_few</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb55-47" title="47"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;inferred duration (min)&quot;</span>,</a>
<a class="sourceLine" id="cb55-48" title="48">       <span class="dt">y =</span> <span class="st">&quot;real duration (min)&quot;</span>)</a></code></pre></div>
</div>
<div id="join-patch-map-and-duration-comparison-figure" class="section level3">
<h3><span class="header-section-number">5.7.3</span> Join patch map and duration comparison figure</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="co"># wrap together</span></a>
<a class="sourceLine" id="cb56-2" title="2">figure_res_patch &lt;-</a>
<a class="sourceLine" id="cb56-3" title="3"><span class="st">  </span><span class="kw">wrap_plots</span>(<span class="kw">list</span>(fig_basic_residence, figure_patch_duration))<span class="op">+</span></a>
<a class="sourceLine" id="cb56-4" title="4"><span class="st">    </span><span class="kw">plot_annotation</span>(<span class="dt">tag_levels =</span> <span class="st">&quot;a&quot;</span>,</a>
<a class="sourceLine" id="cb56-5" title="5">                  <span class="dt">tag_prefix =</span> <span class="st">&quot;(&quot;</span>,</a>
<a class="sourceLine" id="cb56-6" title="6">                  <span class="dt">tag_suffix =</span> <span class="st">&quot;)&quot;</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb56-7" title="7"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.tag =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>))</a>
<a class="sourceLine" id="cb56-8" title="8"></a>
<a class="sourceLine" id="cb56-9" title="9"><span class="co"># save figure</span></a>
<a class="sourceLine" id="cb56-10" title="10"><span class="kw">ggsave</span>(figure_res_patch,</a>
<a class="sourceLine" id="cb56-11" title="11">       <span class="dt">filename =</span> <span class="st">&quot;figures/fig_calib_residence_patch.png&quot;</span>,</a>
<a class="sourceLine" id="cb56-12" title="12">       <span class="dt">height =</span> <span class="dv">130</span>, <span class="dt">width =</span> <span class="dv">225</span>, <span class="dt">units =</span> <span class="st">&quot;mm&quot;</span>)</a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="residence-patches-and-their-construction.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
